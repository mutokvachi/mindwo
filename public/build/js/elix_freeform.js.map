{"version":3,"sources":["freeform.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"elix_freeform.js","sourcesContent":["/**\r\n * FreeForm - a jQuery plugin for working with arbitrary forms\r\n *\r\n * @param root\r\n * @returns {*}\r\n * @constructor\r\n */\r\n$.fn.FreeForm = function(root)\r\n{\r\n\treturn this.each(function(){\r\n\t\tnew $.FreeForm(this);\r\n\t});\r\n};\r\n\r\n/**\r\n * FreeForm constructor\r\n *\r\n * @param root\r\n * @constructor\r\n */\r\n$.FreeForm = function(root)\r\n{\r\n\t$.data(root, 'FreeForm', this);\r\n\tvar self = this;\r\n\tthis.root = $(root);\r\n\tthis.fields = $('[data-name]', this.root);\r\n\tthis.originalData = {};\r\n\tthis.editButton = $('.dx-edit-general', this.root);\r\n\tthis.saveButton = $('.dx-save-general', this.root);\r\n\tthis.cancelButton = $('.dx-cancel-general', this.root);\r\n\t\r\n\t// Bind callbacks to buttons\r\n\tthis.editButton.click(function() {\r\n\t\tself.edit();\r\n\t});\r\n\tthis.saveButton.click(function() {\r\n\t\tself.save();\r\n\t});\r\n\tthis.cancelButton.click(function() {\r\n\t\tself.cancel();\r\n\t});\r\n};\r\n\r\n/**\r\n * FreeForm methods\r\n */\r\n$.extend($.FreeForm.prototype, {\r\n\t/**\r\n\t * Replace HTML with form input fields\r\n\t */\r\n\tedit: function() {\r\n\t\tvar self = this;\r\n\t\tshow_page_splash(1);\r\n\t\t// a structure for JSON request\r\n\t\tvar request = {\r\n\t\t\tmodel: this.root.data('model'),\r\n\t\t\titem_id: this.root.data('item_id'),\r\n\t\t\tlist_id: this.root.data('list_id'),\r\n\t\t\tfields: []\r\n\t\t};\r\n\t\t\r\n\t\t// collect names of input fields marked with data-name attribute\r\n\t\tthis.fields.each(function() {\r\n\t\t\tself.originalData[$(this).data('name')] = $(this).html();\r\n\t\t\trequest.fields.push({\r\n\t\t\t\tname: $(this).data('name')\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\t// perform a request to the server\r\n\t\t$.ajax({\r\n\t\t\ttype: 'POST',\r\n\t\t\turl: DX_CORE.site_url + 'freeform/' + request.item_id + '/edit',\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: request,\r\n\t\t\tsuccess: function(data)\r\n\t\t\t{\r\n\t\t\t\tif (typeof data.success != \"undefined\" && data.success == 0) {\r\n                                    notify_err(data.error);\r\n                                    hide_page_splash(1);\r\n                                    return;\r\n                                }\r\n                                \r\n                                self.editButton.hide();\r\n\t\t\t\tself.saveButton.show();\r\n\t\t\t\tself.cancelButton.show();\r\n\t\t\t\t\r\n\t\t\t\t// replace original html content of marked elements with input fields\r\n\t\t\t\tfor(var i = 0; i < data.fields.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar name = data.fields[i].name;\r\n\t\t\t\t\tvar input = data.fields[i].input;\r\n\t\t\t\t\tvar elem = $('[data-name=\"' + name + '\"]', self.root);\r\n\t\t\t\t\tif(elem.length)\r\n\t\t\t\t\t\telem.html(input);\r\n\t\t\t\t}\r\n                                hide_page_splash(1);\r\n\t\t\t},\r\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\r\n\t\t\t{\r\n\t\t\t\tconsole.log(textStatus);\r\n\t\t\t\tconsole.log(jqXHR);\r\n                                hide_page_splash(1);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * Submit input field values to the server\r\n\t */\r\n\tsave: function() {\r\n\t\tvar self = this;\r\n\t\tshow_page_splash(1);\r\n                \r\n\t\t// JSON structure\r\n\t\tvar request = {\r\n\t\t\tmodel: this.root.data('model'),\r\n\t\t\titem_id: this.root.data('item_id'),\r\n\t\t\tlist_id: this.root.data('list_id'),\r\n\t\t\tfields: []\r\n\t\t};\r\n\t\t\r\n\t\t// collect values of input fields\r\n\t\tthis.fields.each(function() {\r\n\t\t\trequest.fields.push({\r\n\t\t\t\tname: $(this).data('name'),\r\n\t\t\t\tdata: $(this).find('[name]').val()\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\t// submit a request\r\n\t\t$.ajax({\r\n\t\t\ttype: 'POST',\r\n\t\t\turl: DX_CORE.site_url + 'freeform/' + request.item_id + '?_method=PUT',\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: request,\r\n\t\t\tsuccess: function(data)\r\n\t\t\t{\r\n\t\t\t\tif (typeof data.success != \"undefined\" && data.success == 0) {\r\n                                    notify_err(data.error);\r\n                                    hide_page_splash(1);\r\n                                    return;\r\n                                }\r\n                                \r\n                                self.editButton.show();\r\n\t\t\t\tself.saveButton.hide();\r\n\t\t\t\tself.cancelButton.hide();\r\n\t\t\t\t\r\n\t\t\t\t// replace input fields with html data from server response\r\n\t\t\t\tfor(var i = 0; i < data.fields.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar name = data.fields[i].name;\r\n\t\t\t\t\tvar html = data.fields[i].html;\r\n\t\t\t\t\tvar elem = $('[data-name=\"' + name + '\"]', self.root);\r\n\t\t\t\t\tif(elem.length)\r\n\t\t\t\t\t\telem.html(html);\r\n\t\t\t\t}\r\n                                hide_page_splash(1);\r\n\t\t\t},\r\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\r\n\t\t\t{\r\n\t\t\t\tconsole.log(textStatus);\r\n\t\t\t\tconsole.log(jqXHR);\r\n                                hide_page_splash(1);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * Remove input fields and display original HTML\r\n\t */\r\n\tcancel: function() {\r\n\t\tvar self = this;\r\n\t\tthis.editButton.show();\r\n\t\tthis.saveButton.hide();\r\n\t\tthis.cancelButton.hide();\r\n\t\tthis.fields.each(function() {\r\n\t\t\t$(this).html(self.originalData[$(this).data('name')]);\r\n\t\t});\r\n\t}\r\n});\r\n    \r\n"]}