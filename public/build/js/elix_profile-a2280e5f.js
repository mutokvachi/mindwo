!function(e){e.fn.FreeForm=function(t){var i=e.extend({},e.fn.FreeForm.defaults,t);return this.each(function(){new e.FreeForm(this,i)})},e.fn.FreeForm.defaults={},e.FreeForm=function(t,i){e.data(t,"FreeForm",this);var o=this;this.root=e(t),this.options=i,this.fields=e("[data-name]",this.root),this.originalData={},this.editButton=e(".dx-edit-general",this.root),this.saveButton=e(".dx-save-general",this.root),this.cancelButton=e(".dx-cancel-general",this.root),this.editButton.click(function(){o.edit()}),this.saveButton.click(function(){o.save()}),this.cancelButton.click(function(){o.cancel()})},e.extend(e.FreeForm.prototype,{edit:function(){var t=this,i={model:this.root.data("model"),item_id:this.root.data("item_id"),list_id:this.root.data("list_id"),fields:[]};this.fields.each(function(){t.originalData[e(this).data("name")]=e(this).html(),i.fields.push({name:e(this).data("name")})}),show_page_splash(1),e.ajax({type:"POST",url:DX_CORE.site_url+"freeform/"+i.item_id+"/edit",dataType:"json",data:i,success:function(i){if("undefined"!=typeof i.success&&0==i.success)return notify_err(i.error),void hide_page_splash(1);t.editButton.hide(),t.saveButton.show(),t.cancelButton.show();for(var o=0;o<i.fields.length;o++){var s=i.fields[o].name,n=i.fields[o].input,d=e('[data-name="'+s+'"]',t.root);d.length&&d.html(n)}hide_page_splash(1)},error:function(e,t,i){console.log(t),console.log(e),console.log(i)}})},save:function(){var t=this,i={model:this.root.data("model"),item_id:this.root.data("item_id"),list_id:this.root.data("list_id"),fields:[]};this.fields.each(function(){i.fields.push({name:e(this).data("name"),data:e(this).find("[name]").val()})}),show_page_splash(1),e.ajax({type:"POST",url:DX_CORE.site_url+"freeform/"+i.item_id+"?_method=PUT",dataType:"json",data:i,success:function(i){if("undefined"!=typeof i.success&&0==i.success)return notify_err(i.error),void hide_page_splash(1);t.editButton.show(),t.saveButton.hide(),t.cancelButton.hide();for(var o=0;o<i.fields.length;o++){var s=i.fields[o].name,n=i.fields[o].html,d=e('[data-name="'+s+'"]',t.root);d.length&&d.html(n)}hide_page_splash(1)},error:function(e,t,i){console.log(t),console.log(e),console.log(i)}})},cancel:function(){var t=this;this.editButton.show(),this.saveButton.hide(),this.cancelButton.hide(),this.fields.each(function(){e(this).html(t.originalData[e(this).data("name")])})}})}(jQuery),function(e){e.fn.InlineForm=function(t){var i=e.extend({},e.fn.InlineForm.defaults,t);return this.each(function(){new e.InlineForm(this,i)})},e.fn.InlineForm.defaults={beforeSave:null,afterSave:null,empl_search_page_url:"/search"},e.InlineForm=function(t,i){e.data(t,"InlineForm",this);var o=this;this.options=i,this.root=e(t),this.tabs=e(".tab-pane",this.root),this.originalTabs={},this.editButton=e(".dx-edit-profile",this.root),this.saveButton=e(".dx-save-profile",this.root),this.cancelButton=e(".dx-cancel-profile",this.root),this.deleteButton=e(".dx-delete-profile",this.root),this.requests,this.onRequestSuccess,this.onRequestFailed,this.editButton.click(function(){o.edit()}),this.saveButton.click(function(){o.save()}),this.cancelButton.click(function(){o.cancel()}),this.deleteButton.click(function(){o.destroy()})},e.extend(e.InlineForm.prototype,{initRequest:function(e){this.requests={total:e,succeeded:0,failed:0},this.onRequestSuccess=[],this.onRequestFailed=[]},setRequestStatus:function(e){if(e?this.requests.succeeded++:this.requests.failed++,this.requests.total===this.requests.succeeded+this.requests.failed){if(0===this.requests.failed)for(var t=0;t<this.onRequestSuccess.length;t++)this.onRequestSuccess[t].func(this.onRequestSuccess[t].args);else for(var t=0;t<this.onRequestFailed.length;t++)this.onRequestFailed[t].func(this.onRequestFailed[t].args);hide_page_splash(1)}},edit:function(){var t=this,i={list_id:this.root.data("list_id"),tab_list:[]};this.tabs.each(function(){t.originalTabs[e(this).data("tabTitle")]=e(this).html()}),show_page_splash(1),e.ajax({type:"POST",url:DX_CORE.site_url+"inlineform/"+this.root.data("item_id")+"/edit",dataType:"json",data:i,success:function(i){if("undefined"!=typeof i.success&&0==i.success)return notify_err(i.error),void hide_page_splash(1);t.editButton.hide();for(var o=e(e.parseHTML("<div>"+i.tabs+"</div>")).find(".tab-pane"),s=0;s<o.length;s++){var n=e(o[s]),d=e('[data-tab-title="'+n.data("tabTitle")+'"]',t.root);d.length&&d.html(n.html())}1==t.root.data("has_users_documents_access")&&window.DxEmpPersDocs.toggleDisable(!1),hide_page_splash(1),e(".dx-stick-footer").show()},error:function(e,t,i){console.log(t),console.log(e),hide_page_splash(1)}})},save:function(){var t=this,i=process_data_fields(this.root.attr("id"));i.append("item_id",this.root.data("item_id")),i.append("list_id",this.root.data("list_id")),i.append("edit_form_id",this.root.data("form_id")),i.append("redirect_url",this.root.data("redirect_url"));var o=DX_CORE.site_url+"inlineform";"create"!=this.root.data("mode")&&(o+="/"+this.root.data("item_id")+"?_method=PUT"),show_page_splash(1),e.ajax({type:"POST",url:o,dataType:"json",processData:!1,contentType:!1,data:i,success:function(i){if("undefined"!=typeof i.success&&0==i.success)return notify_err(i.error),void hide_page_splash(1);if("create"==t.root.data("mode"))return void(1==t.root.data("has_users_documents_access")?(window.DxEmpPersDocs.userId=i.item_id,window.DxEmpPersDocs.onClickSaveDocs(function(){window.DxEmpPersDocs.toggleDisable(!0),hide_page_splash(1),e(".dx-stick-footer").hide(),window.location=i.redirect})):(hide_page_splash(1),e(".dx-stick-footer").hide(),window.location=i.redirect));if(1==t.root.data("has_users_documents_access"))window.DxEmpPersDocs.onClickSaveDocs(function(){window.DxEmpPersDocs.toggleDisable(!0),t.editButton.show();for(var o=e(e.parseHTML("<div>"+i.tabs+"</div>")).find(".tab-pane"),s=0;s<o.length;s++){var n=e(o[s]),d=e('[data-tab-title="'+n.data("tabTitle")+'"]',t.root);d.length&&d.html(n.html())}t.options.afterSave&&t.options.afterSave(),hide_page_splash(1),e(".dx-stick-footer").hide()});else{t.editButton.show();for(var o=e(e.parseHTML("<div>"+i.tabs+"</div>")).find(".tab-pane"),s=0;s<o.length;s++){var n=e(o[s]),d=e('[data-tab-title="'+n.data("tabTitle")+'"]',t.root);d.length&&d.html(n.html())}t.options.afterSave&&t.options.afterSave(),hide_page_splash(1),e(".dx-stick-footer").hide()}},error:function(e,t,i){console.log(e),console.log(i)}})},cancel:function(){if("create"==this.root.data("mode"))return show_page_splash(1),void(window.location=this.options.empl_search_page_url);this.editButton.show();for(var t in this.originalTabs)this.tabs.filter('[data-tab-title="'+t+'"]').html(this.originalTabs[t]);e(".dx-stick-footer").hide(),1==this.root.data("has_users_documents_access")&&window.DxEmpPersDocs.cancelEditMode()},destroy:function(){if(confirm(Lang.get("frame.confirm_delete"))){var t={edit_form_id:this.root.data("form_id"),item_id:this.root.data("item_id")};show_page_splash(1),e.ajax({type:"POST",url:DX_CORE.site_url+"inlineform/"+this.root.data("item_id")+"?_method=DELETE",dataType:"json",data:t,success:function(e){return"undefined"!=typeof e.success&&0==e.success?(notify_err(e.error),void hide_page_splash(1)):void(window.location=e.redirect)},error:function(e,t,i){console.log(t),console.log(e),hide_page_splash(1)}})}}})}(jQuery),function(e){e.fn.EmplLinksFix=function(t){var i=e.extend({},e.fn.EmplLinksFix.defaults,t);return this.each(function(){new e.EmplLinksFix(this,i)})},e.fn.EmplLinksFix.defaults={profile_url:"/employee/profile/"},e.EmplLinksFix=function(t,i){e.data(t,"EmplLinksFix",this);var o=this;this.options=i,this.root=e(t),this.flds_managers=e(".dx-autocompleate-field[data-item-field=manager_id], .dx-autocompleate-field[data-item-field=reporting_manager_id]",this.root),this.tiles_managers=e(".employee-manager-tile",this.root),this.tiles_managers.each(function(){e(this).data("is-fix-init")||(e(this).click(function(){o.show_tile_manager(e(this).data("empl-id"))}),e(this).data("is-fix-init",1))}),this.flds_managers.each(function(){if(!e(this).data("is-fix-init")){var t=e(this);t.find(".dx-rel-id-add-btn").off("click"),t.find(".dx-rel-id-add-btn").click(function(){o.show_manager(t)}),t.find(".dx-rel-id-add-btn").tooltipster("destroy"),t.find(".dx-rel-id-add-btn").attr("title",Lang.get("empl_profile.hint_view_profile")),t.find(".dx-rel-id-add-btn").tooltipster({theme:"tooltipster-light",animation:"grow",maxWidth:300}),e(this).data("is-fix-init",1)}})},e.extend(e.EmplLinksFix.prototype,{show_manager:function(e){var t=e.find(".dx-auto-input-id").val();0!=t&&(show_page_splash(1),window.location=this.options.profile_url+t)},show_tile_manager:function(e){show_page_splash(1),window.location=this.options.profile_url+e}})}(jQuery),$(document).ajaxComplete(function(){$(".dx-employee-profile.freeform").EmplLinksFix()}),$(document).ready(function(){$(".dx-employee-profile.freeform").EmplLinksFix()}),window.DxEmpPersDocs=window.DxEmpPersDocs||{rowCount:0,userId:0,dateFormat:"",locale:"en",empDocListId:0,empDocFldId:0,isInit:!1,viewClone:"",callbackOnInitiSuccess:function(e){},callbackOnSaveSuccess:function(e){},callbackOnError:function(e){},init:function(e){e?window.DxEmpPersDocs.callbackOnInitiSuccess=e:window.DxEmpPersDocs.callbackOnInitiSuccess=function(){},window.DxEmpPersDocs.userId=""==$("#dx-emp-pers-docs-panel").attr("data-user-id")?0:$("#dx-emp-pers-docs-panel").attr("data-user-id"),window.DxEmpPersDocs.dateFormat=$("#dx-emp-pers-docs-panel").attr("data-date-format"),window.DxEmpPersDocs.locale=$("#dx-emp-pers-docs-panel").attr("data-locale"),window.DxEmpPersDocs.empDocListId=$("#dx-emp-pers-docs-panel").attr("data-emp-docs-list-id"),window.DxEmpPersDocs.empDocFldId=$("#dx-emp-pers-docs-panel").attr("data-emp-docs-fld-id"),$("#dx-emp-pers-docs-country").change(window.DxEmpPersDocs.onChangeCountry),window.DxEmpPersDocs.loadEmployeeData()},enterEditMode:function(){window.DxEmpPersDocs.viewClone=$("#dx-emp-pers-docs-panel").clone(!0,!0)},cancelEditMode:function(){$("#dx-emp-pers-docs-panel").replaceWith(window.DxEmpPersDocs.viewClone),window.DxEmpPersDocs.viewClone=null,window.DxEmpPersDocs.toggleDisable(!0)},loadEmployeeData:function(){$.ajax({url:"/employee/personal_docs/get/employee_docs/"+window.DxEmpPersDocs.userId,type:"get",success:window.DxEmpPersDocs.onSuccessLoadEmployeeData,error:window.DxEmpPersDocs.onAjaxError})},onSuccessLoadEmployeeData:function(e){if(""!=e)for(var t=JSON.parse(e),i=0;i<t.length;i++)window.DxEmpPersDocs.createNewDocRow(!1,t[i]);$("#dx-emp-pers-docs-country").trigger("change")},createNewDocRow:function(e,t){var i=$($("#dx-emp-pers-docs-new-row").html());i=e?window.DxEmpPersDocs.setDocTypeValue(i,t):window.DxEmpPersDocs.setValues(i,t),e?$("#dx-emp-pers-docs-table").append(i):$("#dx-emp-pers-docs-table-history").append(i),window.DxEmpPersDocs.bindDocRowEvenets(i),window.DxEmpPersDocs.rowCount++},initValidToDatePicker:function(e,t){var i=e.find(".dx-emp-pers-docs-validto-input");return i.attr("id","dx-emp-pers-docs-validto-input-"+window.DxEmpPersDocs.rowCount),i.val(t),i.datetimepicker({lang:window.DxEmpPersDocs.locale,format:window.DxEmpPersDocs.dateFormat,timepicker:0,dayOfWeekStart:1,closeOnDateSelect:!0}),e.find(".dx-emp-pers-docs-validto-input-calc").click({picker_num:window.DxEmpPersDocs.rowCount},function(e){jQuery("#dx-emp-pers-docs-validto-input-"+e.data.picker_num).datetimepicker("show")}),e},setDocTypeValue:function(e,t){return e=window.DxEmpPersDocs.initValidToDatePicker(e,""),e.attr("id","dx-emp-pers-docs-row-"+t.id),e.find(".dx-emp-pers-docs-type-input").val(t.id),e.find(".dx-emp-pers-docs-type-label").html(t.name),e},setValues:function(e,t){return e=window.DxEmpPersDocs.initValidToDatePicker(e,t.valid_to),e.attr("id","dx-emp-pers-docs-row-"+t.doc_id),e.find(".dx-emp-pers-docs-id-input").val(t.id),e.find(".dx-emp-pers-docs-type-input").val(t.doc_id),e.find(".dx-emp-pers-docs-type-label").html(t.personal_document.name),e.find(".dx-emp-pers-docs-docnr-input").val(t.doc_nr),e.find(".dx-emp-pers-docs-publisher-input").val(t.publisher),window.DxEmpPersDocs.setFileValue(e,t.id,t.file_name),e},setFileValue:function(e,t,i){if(i&&null!=i){var o="<a href='JavaScript: download_file("+t+" , "+window.DxEmpPersDocs.empDocListId+", "+window.DxEmpPersDocs.empDocFldId+");'>"+i+"</a>";e.find(".dx-emp-pers-docs-file-input-download").html(o),e.find(".dx-emp-pers-docs-file-input-isset").val(1)}},clearDocRow:function(e){var t=$(e.target).parents(".dx-emp-pers-docs-row");t.find(".dx-emp-pers-docs-id-input").val(0),t.find(".dx-emp-pers-docs-docnr-input").val(""),t.find(".dx-emp-pers-docs-validto-input").val(""),t.find(".dx-emp-pers-docs-publisher-input").val(""),t.find(".dx-emp-pers-docs-file-input-remove-btn").trigger("click")},getDataForSave:function(){for(var e=$("#dx-emp-pers-docs-table .dx-emp-pers-docs-row"),t={user_id:window.DxEmpPersDocs.userId,rows:[]},i=new FormData,o=0;o<e.length;o++){var s=$(e[o]),n={};n.id=s.find(".dx-emp-pers-docs-id-input").val(),n.document_type=s.find(".dx-emp-pers-docs-type-input").val(),n.publisher=s.find(".dx-emp-pers-docs-publisher-input").val(),n.valid_to=s.find(".dx-emp-pers-docs-validto-input").val(),n.doc_nr=s.find(".dx-emp-pers-docs-docnr-input").val(),n.file_remove=""===$.trim(s.find(".dx-emp-pers-docs-file-input-download").html());var d=s.find(".dx-emp-pers-docs-file-input-file").prop("files")[0];i.append("file"+o,d),t.rows.push(n)}return i.append("doc_country_id",$("#dx-emp-pers-docs-country").val()),i.append("data",JSON.stringify(t)),i},bindDocRowEvenets:function(e){e.find(".dx-emp-pers-docs-clear-btn").click(window.DxEmpPersDocs.clearDocRow)},onChangeCountry:function(e){var t=$(e.target).val();$.ajax({url:DX_CORE.site_url+"employee/personal_docs/get/docs_by_country/"+t,type:"get",success:window.DxEmpPersDocs.onSuccessChangeCountry,error:window.DxEmpPersDocs.onAjaxError})},onSuccessChangeCountry:function(e){var t=JSON.parse(e);window.DxEmpPersDocs.drawRows(t),window.DxEmpPersDocs.finishInit()},drawRows:function(e){$("#dx-emp-pers-docs-table").contents().appendTo("#dx-emp-pers-docs-table-history");for(var t=0;t<e.length;t++){var i=e[t],o=$("#dx-emp-pers-docs-row-"+i.id);o.length>0?o.appendTo("#dx-emp-pers-docs-table"):window.DxEmpPersDocs.createNewDocRow(!0,i)}$("#dx-emp-pers-docs-table").find("[data-tooltip-title]").each(function(e,t){$(t).attr("title",$(t).data("tooltip-title")),$(t).tooltip()})},finishInit:function(){window.DxEmpPersDocs.isInit||(window.DxEmpPersDocs.isInit=!0,0==window.DxEmpPersDocs.userId?window.DxEmpPersDocs.toggleDisable(!1):window.DxEmpPersDocs.toggleDisable(!0),window.DxEmpPersDocs.callbackOnInitiSuccess())},onClickSaveDocs:function(e,t){e?window.DxEmpPersDocs.callbackOnSaveSuccess=e:window.DxEmpPersDocs.callbackOnSaveSuccess=function(){},t?window.DxEmpPersDocs.callbackOnError=t:window.DxEmpPersDocs.callbackOnError=function(){};var i=window.DxEmpPersDocs.getDataForSave();$.ajax({url:DX_CORE.site_url+"employee/personal_docs/save",data:i,type:"post",processData:!1,dataType:"json",contentType:!1,success:window.DxEmpPersDocs.onSuccessSave,error:window.DxEmpPersDocs.onAjaxError})},onSuccessSave:function(e){for(var t=0;t<e.length;t++){var i=e[t],o=$("#dx-emp-pers-docs-row-"+i.doc_id);o.length>0&&(o.find(".dx-emp-pers-docs-id-input").val(i.id),o.find(".dx-emp-pers-docs-file-input-remove-btn").trigger("click"),window.DxEmpPersDocs.setFileValue(o,i.id,i.file_name))}$("#dx-emp-pers-docs-table-history").empty(),window.DxEmpPersDocs.callbackOnSaveSuccess()},onAjaxError:function(e){window.DxEmpPersDocs.finishInit(),window.DxEmpPersDocs.callbackOnError()},toggleDisable:function(e){e||window.DxEmpPersDocs.enterEditMode();for(var t=$("#dx-emp-pers-docs-table .dx-emp-pers-docs-row"),i=0;i<t.length;i++){var o=$(t[i]);o.find(".dx-emp-pers-docs-publisher-input").prop("disabled",e),o.find(".dx-emp-pers-docs-validto-input").prop("disabled",e),o.find(".dx-emp-pers-docs-validto-input-calc").prop("disabled",e),o.find(".dx-emp-pers-docs-docnr-input").prop("disabled",e),e?(o.find(".dx-emp-pers-docs-file-input-set-btn").hide(),o.find(".dx-emp-pers-docs-file-input-file").prop("files")[0]&&o.find(".dx-emp-pers-docs-file-input-remove-btn").hide(),o.find(".dx-emp-pers-docs-clear-btn").hide()):(o.find(".dx-emp-pers-docs-validto-input").datetimepicker("destroy"),o.find(".dx-emp-pers-docs-validto-input").datetimepicker({lang:window.DxEmpPersDocs.locale,format:window.DxEmpPersDocs.dateFormat,timepicker:0,dayOfWeekStart:1,closeOnDateSelect:!0}),o.find(".dx-emp-pers-docs-file-input-set-btn").show(),o.find(".dx-emp-pers-docs-file-input-file").prop("files")[0]&&o.find(".dx-emp-pers-docs-file-input-remove-btn").show(),o.find(".dx-emp-pers-docs-clear-btn").show())}$("#dx-emp-pers-docs-country").prop("disabled",e)}};