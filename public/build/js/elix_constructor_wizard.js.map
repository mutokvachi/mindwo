{"version":3,"sources":["view_editor.js","constructor_tabs.js","constructor_grid.js","constructor_wizard.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5TA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"elix_constructor_wizard.js","sourcesContent":["(function($)\n{\n\t/**\n\t * ViewEditor - a jQuery plugin that inits view editor functionality (columns setting by drag & drop)\n\t *\n\t * @param root\n\t * @returns {*}\n\t * @constructor\n\t */\n\t$.fn.ViewEditor = function(opts)\n\t{\n\t\tvar options = $.extend({}, $.fn.ViewEditor.defaults, opts);\n\t\treturn this.each(function()\n\t\t{\n\t\t\tnew $.ViewEditor(this, options);\n\t\t});\n\t};\n\t\n\t$.fn.ViewEditor.defaults = {\n\t\tview_container: null,\n\t\treloadBlockGrid: null,\n\t\troot_url: \"/\",\n\t\tload_tab_grid: null,\n\t\tonsave: null\n\t};\n\t\n\t/**\n\t * ViewEditor constructor\n\t *\n\t * @param root\n\t * @constructor\n\t */\n\t$.ViewEditor = function(root, opts)\n\t{\n\t\t$.data(root, 'ViewEditor', this);\n\t\tvar self = this;\n\t\t\n\t\tthis.options = opts;\n\t\tthis.root = $(root);\n\t\t\n\t\tif(this.root.hasClass(\"is-init\"))\n\t\t{\n\t\t\treturn; // editor is allready initialized\n\t\t}\n\t\t\n\t\tthis.root.find(\".dx-cms-nested-list\").nestable();\n\t\t\n\t\tthis.handleBtnSaveView(this.options.view_container);\n\t\tthis.handleBtnCopy(this.options.view_container);\n\t\tthis.handleBtnDelete(this.options.view_container);\n\t\tthis.handleFieldOperation(this.options.view_container);\n\t\t\n\t\tvar frm_el = this.root.closest(\".dx-popup-modal\");\n\t\t\n\t\tthis.frm_el = frm_el;\n\t\t\n\t\tthis.setFldEventHandlers(frm_el, frm_el, this.options.view_container);\n\t\tthis.handleSearchField();\n\t\tthis.handleIsMyCheck(this.root);\n\t\t\n\t\tthis.root.find(\".dx-view-btn-copy\").show();\n\t\tthis.root.find(\".dx-view-btn-delete\").show();\n\t\t\n\t\tthis.root.addClass(\"is-init\");\n\t};\n\t\n\t/**\n\t * InlineForm methods\n\t */\n\t$.extend($.ViewEditor.prototype, {\n\t\t\n\t\t/**\n\t\t * Sets events for added/moved field\n\t\t *\n\t\t * @param {object} frm_el Fields UI forms HTML object\n\t\t * @param {object} fld_el Field element HTML object\n\t\t * @param {object} view_container Grid view main object's HTML element\n\t\t * @returns {undefined}\n\t\t */\n\t\tsetFldEventHandlers: function(frm_el, fld_el, view_container)\n\t\t{\n\t\t\tvar self = this;\n\t\t\t\n\t\t\tfld_el.find('.dx-cms-field-remove').click(function()\n\t\t\t{\n\t\t\t\tself.removeFld(frm_el, $(this), view_container);\n\t\t\t});\n\t\t\t\n\t\t\tfld_el.find('.dx-cms-field-add').click(function()\n\t\t\t{\n\t\t\t\tself.addFld(frm_el, $(this), view_container);\n\t\t\t});\n\t\t\t\n\t\t\tfld_el.find('.dx-fld-title').click(function()\n\t\t\t{\n\t\t\t\tself.openSettings($(this), view_container);\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * Moves field from used section to available fields section\n\t\t *\n\t\t * @param {object} frm_el Fields UI forms HTML object\n\t\t * @param {object} fld_el Field element HTML object\n\t\t * @param {object} view_container Grid view main object's HTML element\n\t\t * @returns {undefined}\n\t\t */\n\t\tremoveFld: function(frm_el, fld_el, view_container)\n\t\t{\n\t\t\tfrm_el.find('.dx-fields-container .dx-available ol.dd-list').append(fld_el.closest('.dd-item').clone());\n\t\t\tfld_el.closest('.dd-item').remove();\n\t\t\t\n\t\t\tvar new_el = frm_el.find('.dx-fields-container .dx-available ol.dd-list .dd-item').last();\n\t\t\tthis.setFldEventHandlers(frm_el, new_el, view_container);\n\t\t\t\n\t\t\tthis.clearSearchIfLast(frm_el, 'dx-used');\n\t\t},\n\t\t\n\t\t/**\n\t\t * Moves field from available section to used fields section\n\t\t *\n\t\t * @param {object} frm_el Fields UI forms HTML object\n\t\t * @param {object} fld_el Field element HTML object\n\t\t * @param {object} view_container Grid view main object's HTML element\n\t\t * @returns {undefined}\n\t\t */\n\t\taddFld: function(frm_el, fld_el, view_container)\n\t\t{\n\t\t\tfrm_el.find('.dx-fields-container .dx-used ol.dd-list').append(fld_el.closest('.dd-item').clone());\n\t\t\tfld_el.closest('.dd-item').remove();\n\t\t\t\n\t\t\tvar new_el = frm_el.find('.dx-fields-container .dx-used ol.dd-list .dd-item').last();\n\t\t\tthis.setFldEventHandlers(frm_el, new_el, view_container);\n\t\t\t\n\t\t\tthis.clearSearchIfLast(frm_el, 'dx-available');\n\t\t},\n\t\t\n\t\t/**\n\t\t * Sets handles for checkboxies (is default and is my view only)\n\t\t *\n\t\t * @param {object} frm_el Fields UI forms HTML object\n\t\t * @returns {undefined}\n\t\t */\n\t\thandleIsMyCheck: function(frm_el)\n\t\t{\n\t\t\tfrm_el.find(\"input[name=is_my_view]\").change(function()\n\t\t\t{\n\t\t\t\tif($(this).prop('checked'))\n\t\t\t\t{\n\t\t\t\t\tfrm_el.find(\"input[name=is_default]\").prop('checked', '').closest('span').hide();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfrm_el.find(\"input[name=is_default]\").closest('span').show();\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tfrm_el.find(\"input[name=is_default]\").change(function()\n\t\t\t{\n\t\t\t\tif($(this).prop('checked'))\n\t\t\t\t{\n\t\t\t\t\tfrm_el.find(\"input[name=is_my_view]\").prop('checked', '').closest('span').hide();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfrm_el.find(\"input[name=is_my_view]\").closest('span').show();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * Clear fields search input in case if no more fields in container (and show again all fields in container)\n\t\t *      *\n\t\t * @param {object} frm_el Fields UI forms HTML object\n\t\t * @param {string} fields_class HTML class name of fields container (dx-used or dx-available)\n\t\t * @returns {undefined}\n\t\t */\n\t\tclearSearchIfLast: function(frm_el, fields_class)\n\t\t{\n\t\t\tif(frm_el.find('.dx-fields-container .' + fields_class + ' ol.dd-list .dd-item:visible').length == 0)\n\t\t\t{\n\t\t\t\tvar txt = frm_el.find('.dx-fields-container .' + fields_class).closest('.portlet').find('input.dx-search');\n\t\t\t\tif(txt.val().length > 0)\n\t\t\t\t{\n\t\t\t\t\ttxt.val('');\n\t\t\t\t\ttxt.closest(\".portlet\").find(\".dx-fields-container .dd-item\").show();\n\t\t\t\t\ttxt.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Opens field's setting form\n\t\t *\n\t\t * @param {object} title_el Field item title HTML element\n\t\t * @param {object} view_container Grid view main object's HTML element\n\t\t * @returns {undefined}\n\t\t */\n\t\topenSettings: function(title_el, view_container)\n\t\t{\n\t\t\tif(title_el.closest('.dx-cms-nested-list').hasClass('dx-used'))\n\t\t\t{\n\t\t\t\tvar item = title_el.closest('.dd-item');\n\t\t\t\tvar sett_el = view_container.find('.dx-popup-modal-settings');\n\t\t\t\t\n\t\t\t\tsett_el.find(\"input[name=is_hidden]\").prop(\"checked\", (item.attr(\"data-is-hidden\") == \"1\") ? \"checked\" : \"\");\n\t\t\t\tsett_el.find(\"input[name=field_title]\").val(title_el.text());\n\t\t\t\tsett_el.find(\"select[name=field_operation]\").val(item.attr(\"data-operation-id\"));\n\t\t\t\t\n\t\t\t\tif(item.attr(\"data-field-type\") == \"autocompleate\" || item.attr(\"data-field-type\") == \"rel_id\")\n\t\t\t\t{\n\t\t\t\t\tsett_el.find(\"select[name=field_operation]\").attr(\"data-criteria\", \"auto\");\n\t\t\t\t\t\n\t\t\t\t\tvar auto_fld = sett_el.find(\"div.dx-autocompleate-field\");\n\t\t\t\t\tauto_fld.attr(\"data-rel-list-id\", item.attr('data-rel-list-id'));\n\t\t\t\t\tauto_fld.attr(\"data-rel-field-id\", item.attr('data-rel-field-id'));\n\t\t\t\t\tauto_fld.attr(\"data-item-value\", item.attr('data-criteria'));\n\t\t\t\t\tauto_fld.attr(\"data-field-id\", item.attr('data-id'));\n\t\t\t\t\t\n\t\t\t\t\tvar formData = new FormData();\n\t\t\t\t\tformData.append(\"list_id\", item.attr('data-rel-list-id'));\n\t\t\t\t\tformData.append(\"txt_field_id\", item.attr('data-rel-field-id'));\n\t\t\t\t\tformData.append(\"txt_field_id\", item.attr('data-rel-field-id'));\n\t\t\t\t\tformData.append(\"value_id\", item.attr('data-criteria'));\n\t\t\t\t\t\n\t\t\t\t\tshow_form_splash();\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\turl: DX_CORE.site_url + \"view/auto_data\",\n\t\t\t\t\t\tdata: formData,\n\t\t\t\t\t\tprocessData: false,\n\t\t\t\t\t\tcontentType: false,\n\t\t\t\t\t\tdataType: \"json\",\n\t\t\t\t\t\tasync: false,\n\t\t\t\t\t\tsuccess: function(data)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thide_form_splash();\n\t\t\t\t\t\t\tauto_fld.attr(\"data-min-length\", data['count']);\n\t\t\t\t\t\t\tauto_fld.attr(\"data-item-text\", data['txt']);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tAutocompleateField.initSelect(auto_fld);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tsett_el.find(\"select[name=field_operation]\").attr(\"data-criteria\", \"text\");\n\t\t\t\t\tsett_el.find(\"input[name=criteria_value]\").val(item.attr(\"data-criteria\"));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.showHideCriteria(sett_el, sett_el.find(\"select[name=field_operation]\"));\n\t\t\t\t\n\t\t\t\tvar btn_save = sett_el.find('.dx-settings-btn-save');\n\t\t\t\t\n\t\t\t\tbtn_save.off(\"click\");\n\t\t\t\tbtn_save.click(function()\n\t\t\t\t{\n\t\t\t\t\tvar oper_el = sett_el.find('select[name=field_operation]');\n\t\t\t\t\t\n\t\t\t\t\tvar crit_val = \"\";\n\t\t\t\t\tif(oper_el.attr(\"data-criteria\") == \"text\")\n\t\t\t\t\t{\n\t\t\t\t\t\tcrit_val = sett_el.find('input[name=criteria_value]').val();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcrit_val = parseInt(sett_el.find('input.dx-auto-input-id').val());\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(oper_el.val() && oper_el.find('option:selected').attr('data-is-criteria') != \"0\" && !crit_val)\n\t\t\t\t\t{\n\t\t\t\t\t\tnotify_err(Lang.get('grid.error_filter_must_be_set'));\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\titem.attr(\"data-criteria\", crit_val);\n\t\t\t\t\titem.attr(\"data-is-hidden\", sett_el.find('input[name=is_hidden]').is(\":checked\") ? 1 : 0);\n\t\t\t\t\titem.attr(\"data-operation-id\", oper_el.val());\n\t\t\t\t\t\n\t\t\t\t\tsett_el.modal('hide');\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tsett_el.modal('show');\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Handles event for show or hide criteria field depending on selected operation\n\t\t *\n\t\t * @param {object} view_container Grid view main object's HTML element\n\t\t * @returns {undefined}\n\t\t */\n\t\thandleFieldOperation: function(view_container)\n\t\t{\n\t\t\tvar self = this;\n\t\t\t\n\t\t\tvar sett_el = view_container.find('.dx-popup-modal-settings');\n\t\t\tsett_el.find('select[name=field_operation]').change(function()\n\t\t\t{\n\t\t\t\tself.showHideCriteria(sett_el, $(this));\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * Shoe or hide criteria field depending on selected operation\n\t\t * @param {object} sett_el Setting popup form HTML element\n\t\t * @param {object} sel_el Operation select HTML element\n\t\t * @returns {undefined}\n\t\t */\n\t\tshowHideCriteria: function(sett_el, sel_el)\n\t\t{\n\t\t\tif(sel_el.find('option:selected').attr('data-is-criteria') != \"0\")\n\t\t\t{\n\t\t\t\tif(sel_el.attr(\"data-criteria\") == \"text\")\n\t\t\t\t{\n\t\t\t\t\tsett_el.find(\".dx-criteria-text\").show();\n\t\t\t\t\tsett_el.find(\".dx-criteria-auto\").hide();\n\t\t\t\t\tsett_el.find(\"input[name=criteria_value]\").focus();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tsett_el.find(\".dx-criteria-text\").hide();\n\t\t\t\t\tsett_el.find(\".dx-criteria-auto\").show();\n\t\t\t\t\tsett_el.find('.dx-auto-input-select2').select2(\"open\");\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsett_el.find(\"input[name=criteria_value]\").val('');\n\t\t\t\tsett_el.find(\".dx-criteria-auto\").hide();\n\t\t\t\tsett_el.find(\".dx-criteria-text\").hide();\n\t\t\t\tsett_el.find('.dx-auto-input-select2').select2('data', {id: 0, text: \"\"});\n\t\t\t\tsett_el.find(\"input.dx-auto-input-id\").val(0);\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Handles fields searching functionality\n\t\t * @returns {undefined}\n\t\t */\n\t\thandleSearchField: function()\n\t\t{\n\t\t\t$(\"input.dx-search\").on(\"keyup\", function()\n\t\t\t{\n\t\t\t\tif(!$(this).val())\n\t\t\t\t{\n\t\t\t\t\t$(this).closest(\".portlet\").find(\".dx-fields-container .dd-item\").show();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$(this).closest(\".portlet\").find(\".dx-fields-container .dd-item\").hide();\n\t\t\t\t$(this).closest(\".portlet\").find(\".dx-fields-container .dx-fld-title:contains('\" + $(this).val() + \"')\").closest(\".dd-item\").show();\n\t\t\t\t\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * Handles view copy function\n\t\t *\n\t\t * @param {object} view_container Grid view main object's HTML element\n\t\t * @returns {undefined}\n\t\t */\n\t\thandleBtnCopy: function(view_container)\n\t\t{\n\t\t\tvar pop_el = $(\"#\" + view_container.attr(\"id\") + \"_popup\");\n\t\t\tpop_el.find(\".dx-view-btn-copy\").click(function()\n\t\t\t{\n\t\t\t\tvar frm_el = pop_el.find(\".dx-view-edit-form\");\n\t\t\t\tfrm_el.data('view-id', 0);\n\t\t\t\tpop_el.find(\".dx-view-btn-copy\").hide();\n\t\t\t\tpop_el.find(\".dx-view-btn-delete\").hide();\n\t\t\t\tpop_el.find(\"span.badge\").html(Lang.get('grid.badge_new'));\n\t\t\t\tfrm_el.find(\"input[name=view_title]\").val(frm_el.find(\"input[name=view_title]\").val() + \" - \" + Lang.get('grid.title_copy')).focus();\n\t\t\t\t\n\t\t\t\tfrm_el.find('input[name=is_default]').prop(\"checked\", '').show().closest('span').show();\n\t\t\t\tfrm_el.find('input[name=is_my_view]').prop(\"checked\", '').closest('span').show();\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * Handles button \"Delete\" pressing\n\t\t *\n\t\t * @param {object} view_container Grid view main object's HTML element\n\t\t * @returns {undefined}\n\t\t */\n\t\thandleBtnDelete: function(view_container)\n\t\t{\n\t\t\tvar self = this;\n\t\t\tvar pop_el = $(\"#\" + view_container.attr(\"id\") + \"_popup\");\n\t\t\tpop_el.find(\".dx-view-btn-delete\").click(function()\n\t\t\t{\n\t\t\t\tPageMain.showConfirm(self.deleteView, {\n\t\t\t\t\tview_container: view_container,\n\t\t\t\t\tself: self\n\t\t\t\t}, null, Lang.get('grid.confirm_delete'), Lang.get('form.btn_yes'), Lang.get('form.btn_no'));\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * Loads view after previous view deletion or new view creation\n\t\t *\n\t\t * @param {object} view_container Grid view main object's HTML element\n\t\t * @param {integer} view_id View ID\n\t\t * @returns {undefined}\n\t\t */\n\t\treloadAnotherView: function(view_container, view_id)\n\t\t{\n\t\t\tif(view_container.attr('dx_tab_id'))\n\t\t\t{\n\t\t\t\tif(this.options.load_tab_grid)\n\t\t\t\t{\n\t\t\t\t\tthis.options.load_tab_grid(view_container.attr('dx_tab_id'), view_container.attr('dx_list_id'), view_id, view_container.attr('dx_rel_field_id'), view_container.attr('dx_rel_field_value'), view_container.attr('dx_form_htm_id'), 1, 5, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tshow_page_splash(1);\n\t\t\t\tvar url = this.options.root_url + 'skats_' + view_id;\n\t\t\t\twindow.location.assign(encodeURI(url));\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Handles view deletion functionality\n\t\t *\n\t\t * @param {object} view_container Grid view main object's HTML element\n\t\t * @returns {undefined}\n\t\t */\n\t\tdeleteView: function(params)\n\t\t{\n\t\t\tvar self = params.self;\n\t\t\tvar view_container = params.view_container;\n\t\t\t\n\t\t\tvar pop_el = $(\"#\" + view_container.attr(\"id\") + \"_popup\");\n\t\t\tvar frm_el = pop_el.find(\".dx-view-edit-form\");\n\t\t\t\n\t\t\tvar formData = new FormData();\n\t\t\tformData.append(\"view_id\", frm_el.data('view-id'));\n\t\t\tformData.append(\"list_id\", frm_el.data('list-id'));\n\t\t\tformData.append('tab_id', view_container.attr('dx_tab_id'));\n\t\t\t\n\t\t\tvar request = new FormAjaxRequest('view/delete', \"\", \"\", formData);\n\t\t\trequest.progress_info = true;\n\t\t\t\n\t\t\trequest.callback = function(data)\n\t\t\t{\n\t\t\t\tif(data[\"success\"] == 1)\n\t\t\t\t{\n\t\t\t\t\tpop_el.modal('hide');\n\t\t\t\t\tself.reloadAnotherView(view_container, data[\"view_id\"]);\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\t// execute AJAX request\n\t\t\trequest.doRequest();\n\t\t},\n\t\t\n\t\t/**\n\t\t * Prepares JSON string with all fields included in view (in correct order)\n\t\t *\n\t\t * @param {object} block Fields container HTML element\n\t\t * @returns {string}\n\t\t */\n\t\tgetFieldsState: function(block)\n\t\t{\n\t\t\tvar ret_arr = new Array();\n\t\t\t\n\t\t\tblock.find(\".dd-item\").each(function()\n\t\t\t{\n\t\t\t\tvar item = {\n\t\t\t\t\t\"field_id\": $(this).attr('data-id'),\n\t\t\t\t\t\"aggregation_id\": $(this).attr('data-aggregation-id'),\n\t\t\t\t\t\"list_id\": $(this).attr('data-list-id'),\n\t\t\t\t\t\"is_hidden\": $(this).attr('data-is-hidden'),\n\t\t\t\t\t\"operation_id\": $(this).attr('data-operation-id'),\n\t\t\t\t\t\"criteria\": $(this).attr('data-criteria')\n\t\t\t\t};\n\t\t\t\tret_arr.push(item);\n\t\t\t});\n\t\t\t\n\t\t\treturn JSON.stringify(ret_arr);\n\t\t},\n\t\t\n\t\t/**\n\t\t * Handles button event - save view data\n\t\t *\n\t\t * @param {object} view_container Grid view main object's HTML element\n\t\t * @returns {undefined}\n\t\t */\n\t\thandleBtnSaveView: function(view_container)\n\t\t{\n\t\t\tvar self = this;\n\t\t\tvar pop_el = $(\"#\" + view_container.attr(\"id\") + \"_popup\");\n\t\t\tpop_el.find(\".dx-view-btn-save\").click(function()\n\t\t\t{\n\t\t\t\tself.save();\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * Save view data. Can be invoked externally.\n\t\t */\n\t\tsave: function()\n\t\t{\n\t\t\tvar self = this;\n\t\t\tvar view_container = this.options.view_container;\n\t\t\tvar pop_el = $(\"#\" + view_container.attr(\"id\") + \"_popup\");\n\t\t\tvar frm_el = pop_el.find(\".dx-view-edit-form\");\n\t\t\tvar view_id = frm_el.data('view-id');\n\t\t\tvar grid_el = view_container.find('.dx-grid-table').last();\n\t\t\t\n\t\t\tvar formData = new FormData();\n\t\t\tformData.append(\"view_id\", view_id);\n\t\t\tformData.append(\"list_id\", frm_el.data('list-id'));\n\t\t\tformData.append(\"view_title\", frm_el.find('input[name=view_title]').val());\n\t\t\tformData.append(\"is_default\", frm_el.find('input[name=is_default]').is(\":checked\") ? 1 : 0);\n\t\t\tformData.append(\"is_my_view\", frm_el.find('input[name=is_my_view]').is(\":checked\") ? 1 : 0);\n\t\t\tformData.append(\"fields\", self.getFieldsState(frm_el.find('.dx-fields-container .dx-used')));\n\t\t\tformData.append('grid_id', grid_el.attr('id'));\n\t\t\t\n\t\t\tvar request = new FormAjaxRequest('view/save', \"\", \"\", formData);\n\t\t\trequest.progress_info = true;\n\t\t\t\n\t\t\trequest.callback = function(data)\n\t\t\t{\n\t\t\t\tif(data[\"success\"] == 1)\n\t\t\t\t{\n\t\t\t\t\t\n\t\t\t\t\tif(self.options.onsave)\n\t\t\t\t\t{\n\t\t\t\t\t\tself.options.onsave.call(this, data[\"view_id\"]);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tpop_el.modal('hide');\n\t\t\t\t\t\tpop_el.attr(\"id\", pop_el.attr(\"id\") + \"_\" + $(\".dx-popup-modal\").length);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(view_id == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tself.reloadAnotherView(view_container, data[\"view_id\"]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(self.options.reloadBlockGrid)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tself.options.reloadBlockGrid(grid_el.attr('id'), grid_el.data('tab_id'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\t// execute AJAX request\n\t\t\trequest.doRequest();\n\t\t}\n\t});\n\t\n})(jQuery);\n\n$(document).ajaxComplete(function(event, xhr, settings)\n{\n\t$(\"input.dx-bool\").ViewEditor();\n});\n\n$(document).ready(function()\n{\n\t$(\"input.dx-bool\").ViewEditor();\n});","/**\n * ConstructorTabs - manages form tabs.\n */\nModule.create('ConstructorTabs', {\n\t/**\n\t * Default values of options\n\t */\n\tdefaults: {\n\t\tform_id: 0,\n\t\tlist_id: 0,\n\t\trelatedHtml: ''\n\t},\n\t/**\n\t * Constructor\n\t */\n\tconstruct: function() {\n\t\tvar self = this;\n\t\t\n\t\tthis.activeTabButton = $('.dx-constructor-tab-button').first().addClass('active');\n\t\tthis.activeTab = $('.dx-constructor-tab').first();\n\t\tthis.tabAddModal = $('#fields_tab_add');\n\t\tthis.tabEditModal = $('#fields_tab_edit');\n\t\t\n\t\tthis.root.find('.dd-list').sortable({\n\t\t\tcontainment: 'parent'\n\t\t});\n\t\t\n\t\tthis.root.on('click', '.dd-item a.title', function() {\n\t\t\tself.activate($(this).closest('.dd-item'));\n\t\t});\n\t\t\n\t\tthis.root.find('.dd-item.custom-data').each(function() {\n\t\t\tself.initButton($(this));\n\t\t});\n\t\t\n\t\t$('.dx-tab-add-btn').click(function() {\n\t\t\tself.add();\n\t\t});\n\t\t\n\t\t$('.dx-tab-edit-btn').click(function() {\n\t\t\tself.edit();\n\t\t});\n\t\t\n\t\t$('.dx-tab-delete-btn').click(function() {\n\t\t\tself.del();\n\t\t});\n\t\t\n\t\tthis.tabAddModal.on('click', '.dx-tab-add-save-btn', function() {\n\t\t\tself.addSave();\n\t\t});\n\t\t\n\t\tthis.tabEditModal.on('click', '.dx-tab-edit-save-btn', function() {\n\t\t\tself.editSave();\n\t\t});\n\t},\n\t\n\t/**\n\t * Initialize droppable plugin for specified tab button.\n\t * @param button\n\t */\n\tinitButton(button)\n\t{\n\t\tvar self = this;\n\t\t\n\t\tvar timer;\n\t\t\n\t\tbutton.droppable({\n\t\t\taccept: '.dx-field, .dx-constructor-row',\n\t\t\ttolerance: 'pointer',\n\t\t\tover: function(event, ui) {\n\t\t\t\tvar tab = $(this);\n\t\t\t\t\n\t\t\t\ttimer = setTimeout(function() {\n\t\t\t\t\tself.activate(tab)\n\t\t\t\t}, 1000)\n\t\t\t},\n\t\t\tout: function(event, ui) {\n\t\t\t\tclearTimeout(timer);\n\t\t\t},\n\t\t\tdeactivate: function(event, ui) {\n\t\t\t\tclearTimeout(timer);\n\t\t\t}\n\t\t});\n\t},\n\t\n\t/**\n\t * Activate specified tab\n\t * @param tab\n\t */\n\tactivate: function(tab) {\n\t\t$('.dx-constructor-tab:visible').hide();\n\t\t\n\t\tthis.root.find('.dx-constructor-tab-button').removeClass('active');\n\t\t\n\t\tthis.activeTabButton = tab;\n\t\tthis.activeTabButton.addClass('active');\n\t\t\n\t\tthis.activeTab = $('.dx-constructor-tab.tab-id-' + tab.data('id')).show();\n\t\t\n\t\tif(tab.hasClass('custom-data'))\n\t\t{\n\t\t\tthis.activeTab.find('.dx-constructor-grid').data('ConstructorGrid').updateGrid();\n\t\t}\n\t},\n\t\n\t/**\n\t * Handler for Add tab button\n\t */\n\tadd: function() {\n\t\tvar self = this;\n\t\topen_form('form', 0, 16, 66, this.options.form_id, \"\", 1, \"\", {\n\t\t\tbefore_show: function(frm) {\n\t\t\t\tvar order_index = (($('.dx-constructor-tab-button').length + 1) * 10) + 10;\n\t\t\t\tfrm.find('input[name=\"order_index\"]').val(order_index).prop('disabled', true);\n\t\t\t},\n\t\t\tafter_close: function(frm) {\n\t\t\t\tvar id = frm.find('input[name=\"item_id\"]').val();\n\t\t\t\t\n\t\t\t\tif(id == 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(!$('.dx-constructor-tab-button').length)\n\t\t\t\t{\n\t\t\t\t\t$('.dx-constructor-form-tabs').show();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar title = frm.find('input[name=\"title\"]').val();\n\t\t\t\tvar order_index = frm.find('input[name=\"order_index\"]').val();\n\t\t\t\tvar is_custom_data = (frm.find('input[name=\"is_custom_data\"]').bootstrapSwitch('state'));\n\t\t\t\t\n\t\t\t\tvar button = $(self.options.tabButton);\n\t\t\t\tbutton.find('.title').text(title);\n\t\t\t\tbutton.addClass('tab-id-' + id);\n\t\t\t\tbutton.addClass(is_custom_data ? 'custom_data' : 'related-grid');\n\t\t\t\tbutton.attr('data-id', id);\n\t\t\t\tbutton.attr('data-order', order_index);\n\t\t\t\tbutton = button.appendTo('.dx-constructor-tab-buttons .dd-list');\n\t\t\t\t\n\t\t\t\tvar tab = $('<div class=\"dx-constructor-tab\" style=\"display: none\"></div>')\n\t\t\t\t\t.appendTo('.dx-constructor-tabs-wrap');\n\t\t\t\t\n\t\t\t\ttab.addClass('tab-id-' + id);\n\t\t\t\ttab.attr('data-tab-id', id);\n\t\t\t\ttab.attr('data-tab-title', title);\n\t\t\t\ttab.append('<h5>' + title + '</h5>');\n\t\t\t\t\n\t\t\t\tif(is_custom_data)\n\t\t\t\t{\n\t\t\t\t\ttab.addClass('custom-data');\n\t\t\t\t\t\n\t\t\t\t\tself.initButton(button);\n\t\t\t\t\t\n\t\t\t\t\tvar grid = $('<div class=\"dx-constructor-grid\"></div>').appendTo(tab);\n\t\t\t\t\t\n\t\t\t\t\tgrid.ConstructorGrid({\n\t\t\t\t\t\tlist_id: self.options.list_id\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tgrid.data('ConstructorGrid').createRow();\n\t\t\t\t\tgrid.data('ConstructorGrid').createRow();\n\t\t\t\t\tgrid.data('ConstructorGrid').createRow();\n\t\t\t\t\tgrid.data('ConstructorGrid').createRow();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttab.addClass('related-grid');\n\t\t\t\t\t\n\t\t\t\t\tvar html = $(self.options.relatedHtml);\n\t\t\t\t\t\n\t\t\t\t\tvar tmp = frm.find('input[dx_fld_name=\"grid_list_id\"]');\n\t\t\t\t\ttmp.length && html.find('input[name=\"list_title\"]').val(tmp.val());\n\t\t\t\t\t\n\t\t\t\t\ttmp = frm.find('input[dx_fld_name=\"grid_list_field_id\"]');\n\t\t\t\t\ttmp.length && html.find('input[name=\"field_title\"]').val(tmp.val());\n\t\t\t\t\t\n\t\t\t\t\thtml.appendTo(tab);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tself.activate(button);\n\t\t\t}\n\t\t});\n\t},\n\t\n\t/**\n\t * Handler for Edit tab button\n\t */\n\tedit: function() {\n\t\tvar self = this;\n\t\tvar tab = this.activeTab;\n\t\tvar button = this.activeTabButton;\n\t\t\n\t\topen_form('form', tab.data('tabId'), 16, 66, this.options.form_id, \"\", 1, \"\", {\n\t\t\tbefore_show: function(frm) {\n\t\t\t\tfrm.find('input[name=\"order_index\"]').prop('disabled', true);\n\t\t\t\tfrm.find('input[name=\"is_custom_data\"]').bootstrapSwitch('toggleDisabled', true);\n\t\t\t},\n\t\t\tafter_close: function(frm) {\n\t\t\t\tif(frm.find('input[name=\"item_id\"]').val() == 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar title = frm.find('input[name=\"title\"]').val();\n\t\t\t\tbutton.find('.title').text(title);\n\t\t\t\ttab.attr('data-tab-title', title);\n\t\t\t\ttab.children('h5').text(title);\n\t\t\t\t\n\t\t\t\tif(tab.hasClass('related-grid'))\n\t\t\t\t{\n\t\t\t\t\tvar tmp = frm.find('input[dx_fld_name=\"grid_list_id\"]');\n\t\t\t\t\ttmp.length && tab.find('input[name=\"list_title\"]').val(tmp.val());\n\t\t\t\t\t\n\t\t\t\t\ttmp = frm.find('input[dx_fld_name=\"grid_list_field_id\"]');\n\t\t\t\t\ttmp.length && tab.find('input[name=\"field_title\"]').val(tmp.val());\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\t\n\t/**\n\t * Handler for Delete tab button\n\t */\n\tdel: function() {\n\t\tvar self = this;\n\t\tvar tab = this.activeTab;\n\t\tvar button = this.activeTabButton;\n\t\t\n\t\tif(tab.hasClass('custom-data') && (tab.find('.dx-constructor-row .dx-field').length > 0))\n\t\t{\n\t\t\ttoastr.info(Lang.get('constructor.tab_empty'));\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar func = function() {\n\t\t\tvar request = {\n\t\t\t\t_method: 'delete',\n\t\t\t\tid: tab.data('tabId')\n\t\t\t};\n\t\t\t\n\t\t\t$.ajax({\n\t\t\t\ttype: 'post',\n\t\t\t\turl: '/constructor/register/tab/' + tab.data('tabId'),\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: request,\n\t\t\t\tsuccess: function(data)\n\t\t\t\t{\n\t\t\t\t\thide_page_splash(1);\n\t\t\t\t\t\n\t\t\t\t\ttab.remove();\n\t\t\t\t\tbutton.remove();\n\t\t\t\t\t\n\t\t\t\t\tvar buttons = $('.dx-constructor-tab-button');\n\t\t\t\t\t\n\t\t\t\t\tif(buttons.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tself.activate(buttons.first());\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$('.dx-constructor-form-tabs').hide();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\ttoastr.success(Lang.get('constructor.tab_del_success'))\n\t\t\t\t},\n\t\t\t\terror: function(jqXHR, textStatus, errorThrown)\n\t\t\t\t{\n\t\t\t\t\tconsole.log(textStatus);\n\t\t\t\t\tconsole.log(jqXHR);\n\t\t\t\t\thide_page_splash(1);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\t\n\t\tPageMain.showConfirm(func, null,\n\t\t\tLang.get('constructor.confirm_action'),\n\t\t\tLang.get('constructor.tab_del_confirm'),\n\t\t\t''\n\t\t);\n\t}\n});\n","/**\n * ConstructorGrid - a plugin that manages grid of constructor and allows form to be designed\n * by dragging and dropping elements.\n */\nModule.create('ConstructorGrid', {\n\tdefaults: {\n\t\t'rowHtml': ''\n\t},\n\t/**\n\t * Constructor\n\t */\n\tconstruct: function()\n\t{\n\t\tvar self = this;\n\t\t\n\t\tthis.wizard = $('.dx-constructor-wizard').data('ConstructorWizard');\n\t\t\n\t\tthis.fieldsContainer = $('.dx-fields-container .columns');\n\t\t\n\t\tthis.dialog = $('#fields_popup');\n\t\tthis.dialogId = this.dialog.find('[name=\"field_id\"]');\n\t\tthis.dialogField = this.dialog.find('[name=\"title_form\"]');\n\t\tthis.dialogHidden = this.dialog.find('[name=\"is_hidden\"]');\n\t\t\n\t\t// configuration of Sortable plugin for use inside of form rows\n\t\tthis.sortableOpts = {\n\t\t\tconnectWith: '.columns',\n\t\t\thandle: '.dd-handle',\n\t\t\tplaceholder: 'placeholder',\n\t\t\tforcePlaceholderSize: true,\n\t\t\tforceHelperSize: true,\n\t\t\tcursorAt: {\n\t\t\t\tleft: 30,\n\t\t\t\ttop: 15\n\t\t\t},\n\t\t\tover: function(event, ui)\n\t\t\t{\n\t\t\t\tself.updateGrid();\n\t\t\t},\n\t\t\tout: function(event, ui)\n\t\t\t{\n\t\t\t\tself.updateGrid();\n\t\t\t},\n\t\t\tdeactivate: function(event, ui)\n\t\t\t{\n\t\t\t\tself.updateRow($(this));\n\t\t\t},\n\t\t\tchange: function(event, ui)\n\t\t\t{\n\t\t\t\tself.updateGrid();\n\t\t\t},\n\t\t\treceive: function(event, ui)\n\t\t\t{\n\t\t\t\tif($(this).children().length > 4)\n\t\t\t\t{\n\t\t\t\t\t$(ui.sender).sortable('cancel');\n\t\t\t\t}\n\t\t\t\tself.updateGrid();\n\t\t\t},\n\t\t\thelper: this.sortHelper,\n\t\t\tstart: this.onSortStart,\n\t\t\tstop: this.onSortStop\n\t\t};\n\t\t\n\t\t// fields list at left side\n\t\tthis.fieldsContainer.sortable({\n\t\t\tconnectWith: '.columns',\n\t\t\thandle: '.dd-handle',\n\t\t\tplaceholder: 'placeholder',\n\t\t\tforcePlaceholderSize: true,\n\t\t\treceive: function(event, ui)\n\t\t\t{\n\t\t\t\t$(ui.item).attr('class', 'col-md-12');\n\t\t\t},\n\t\t\tstart: this.onSortStart,\n\t\t\tstop: this.onSortStop\n\t\t});\n\t\t\n\t\t// form rows\n\t\tthis.root.sortable({\n\t\t\t// axis: 'y',\n\t\t\t// containment: 'parent',\n\t\t\tconnectWith: '.dx-constructor-grid',\n\t\t\thandle: '.row-handle',\n\t\t\thelper: this.sortHelper,\n\t\t\tstart: this.onSortStart,\n\t\t\tstop: this.onSortStop\n\t\t});\n\t\t\n\t\t// form row columns\n\t\tthis.root.find('.columns').sortable(this.sortableOpts);\n\t\t\n\t\tthis.root.on('click', '.dx-cms-field-remove', function()\n\t\t{\n\t\t\tvar row = $(this).closest('.dd-list');\n\t\t\t$(this).tooltipster('hide');\n\t\t\tself.removeField($(this).closest('.dd-item').parent());\n\t\t\tself.updateRow(row);\n\t\t});\n\t\t\n\t\tthis.root.on('click', '.dx-cms-field-edit', function()\n\t\t{\n\t\t\tvar item = $(this).closest('.dd-item');\n\t\t\t\n\t\t\tif(item.hasClass('not-in-form'))\n\t\t\t{\n\t\t\t\tself.wizard.submit_fields(function()\n\t\t\t\t{\n\t\t\t\t\tself.showProperties(item);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tself.showProperties(item);\n\t\t\t}\n\t\t});\n\t\t\n\t\tthis.dialog.on('click', '.dx-view-btn-save', function()\n\t\t{\n\t\t\tself.saveProperties();\n\t\t});\n\t\t\n\t\t// handle row deletion\n\t\tthis.root.on('click', '.dx-constructor-row-remove', function()\n\t\t{\n\t\t\t$(this).tooltipster('hide');\n\t\t\tself.removeRow($(this).closest('.dx-constructor-row'))\n\t\t});\n\t},\n\t\n\t/**\n\t * When a field or a row is started to drag, highlight appropriate tabs where it can be dropped to.\n\t * @param event\n\t * @param ui\n\t */\n\tonSortStart: function(event, ui)\n\t{\n\t\t$('.dx-constructor-tab-buttons').addClass('highlight');\n\t},\n\t\n\t/**\n\t * Remove highlights on drag stop.\n\t * @param event\n\t * @param ui\n\t */\n\tonSortStop: function(event, ui)\n\t{\n\t\t$('.dx-constructor-tab-buttons').removeClass('highlight');\n\t},\n\t\n\t/**\n\t * Clones element being dragged. It needed to drag elements between hidden tabs.\n\t * @param event\n\t * @param element\n\t * @returns {*}\n\t */\n\tsortHelper: function(event, element)\n\t{\n\t\tvar el = $(element.clone()).appendTo(document.body);\n\t\treturn el.get(0);\n\t},\n\t\n\t/**\n\t * Add a new row to the grid.\n\t */\n\tcreateRow: function()\n\t{\n\t\tvar row = $(this.options.rowHtml).appendTo(this.root);\n\t\t\n\t\trow.find('.dx-constructor-row-remove').tooltipster({\n\t\t\ttheme: 'tooltipster-light',\n\t\t\tanimation: 'grow'\n\t\t});\n\t\t\n\t\trow.find('.columns').sortable(this.sortableOpts);\n\t},\n\t\n\t/**\n\t * Handle deletion of a field.\n\t * @param field\n\t */\n\tremoveField: function(field)\n\t{\n\t\tfield.appendTo(this.fieldsContainer).attr('class', 'col-md-12');\n\t},\n\t\n\t/**\n\t * Handle removal of a row.\n\t * @param row\n\t */\n\tremoveRow: function(row)\n\t{\n\t\tvar self = this;\n\t\t\n\t\trow.children('.columns').children().each(function()\n\t\t{\n\t\t\tself.removeField($(this));\n\t\t});\n\t\t\n\t\trow.remove();\n\t},\n\t\n\t/**\n\t * Open modal dialog with properties of a field.\n\t * @param item\n\t */\n\tshowProperties: function(item)\n\t{\n\t\tvar fieldId = item.data('id');\n\t\tvar field = item.find('.dx-fld-title').text();\n\t\tvar hidden = item.data('hidden');\n\t\t\n\t\tthis.dialogId.val(fieldId);\n\t\tthis.dialogField.val(field);\n\t\t\n\t\tif((hidden && !this.dialogHidden.prop('checked')) || (!hidden && this.dialogHidden.prop('checked')))\n\t\t{\n\t\t\tthis.dialogHidden.click();\n\t\t}\n\t\t\n\t\tthis.dialog.modal('show');\n\t},\n\t\n\t/**\n\t * Update properties of a field via ajax call.\n\t */\n\tsaveProperties: function()\n\t{\n\t\tvar self = this;\n\t\t\n\t\tvar item = $('.dd-item[data-id=\"' + self.dialogId.val() + '\"]');\n\t\t\n\t\t//show_page_splash(1);\n\t\t\n\t\tvar request = {\n\t\t\t_method: 'put',\n\t\t\tfield_id: self.dialogId.val(),\n\t\t\ttitle_form: self.dialogField.val(),\n\t\t\tis_hidden: self.dialogHidden.prop('checked') ? '1' : '0'\n\t\t};\n\t\t\n\t\t$.ajax({\n\t\t\ttype: 'post',\n\t\t\turl: '/constructor/register/' + self.options.list_id + '/field_update',\n\t\t\tdataType: 'json',\n\t\t\tdata: request,\n\t\t\tsuccess: function(data)\n\t\t\t{\n\t\t\t\titem.find('.dx-fld-title').text(self.dialogField.val());\n\t\t\t\t\n\t\t\t\tif(self.dialogHidden.prop('checked'))\n\t\t\t\t{\n\t\t\t\t\titem.data('hidden', '1');\n\t\t\t\t\titem.addClass('dx-field-hidden');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\titem.data('hidden', '0');\n\t\t\t\t\titem.removeClass('dx-field-hidden');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//hide_page_splash(1);\n\t\t\t},\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\n\t\t\t{\n\t\t\t\tconsole.log(textStatus);\n\t\t\t\tconsole.log(jqXHR);\n\t\t\t\thide_page_splash(1);\n\t\t\t}\n\t\t});\n\t\t\n\t\tself.dialog.modal('hide');\n\t},\n\t\n\t/**\n\t * Update all rows.\n\t */\n\tupdateGrid: function()\n\t{\n\t\tvar self = this;\n\t\t\n\t\tthis.root.find('.row.columns').each(function()\n\t\t{\n\t\t\tself.updateRow($(this));\n\t\t});\n\t},\n\t\n\t/**\n\t * Calculate correct width of fields and apply grid styles to them.\n\t * @param row\n\t */\n\tupdateRow: function(row)\n\t{\n\t\tvar items = row.children().filter(function()\n\t\t{\n\t\t\treturn $(this).css('position') !== 'absolute' && $(this).css('display') !== 'none';\n\t\t});\n\t\t\n\t\tvar count = items.length;\n\t\t\n\t\tif(!count)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar col = Math.floor(12 / count);\n\t\t\n\t\titems.each(function()\n\t\t{\n\t\t\t$(this).removeClass(function(index, className)\n\t\t\t{\n\t\t\t\treturn (className.match(/(^|\\s)col-\\S+/g) || []).join(' ');\n\t\t\t});\n\t\t\t$(this).addClass('col-md-' + col);\n\t\t});\n\t}\n});","/**\n * Author:  Eugene Ostapenko <evo@olympsoft.com>\n * License: MIT\n * Created: 25.05.17, 17:48\n */\nModule.create('ConstructorWizard', {\n\tdefaults: {\n\t\tlist_id: 0,\n\t\tview_id: 1,\n\t\tform_id: 0,\n\t\tstep: 'names',\n\t\tsteps: ['names', 'columns', 'fields', 'rights'],\n\t\turl: '/constructor/register',\n\t\tlast_url: '/skats_'\n\t},\n\t\n\t/**\n\t * Constructor\n\t */\n\tconstruct: function()\n\t{\n\t\tvar self = this;\n\t\t\n\t\tvar initName = 'init_' + this.options.step;\n\t\tvar submitName = 'submit_' + this.options.step;\n\t\t\n\t\t// init current step\n\t\tif($.isFunction(self[initName]))\n\t\t{\n\t\t\tself[initName]();\n\t\t}\n\t\t\n\t\tthis.root.on('click', '.mt-element-step .link', function()\n\t\t{\n\t\t\twindow.location = $(this).data('url');\n\t\t});\n\t\t\n\t\t// submit step\n\t\tthis.root.on('click', '#submit_step', function()\n\t\t{\n\t\t\tif($.isFunction(self[submitName]))\n\t\t\t{\n\t\t\t\tself[submitName]();\n\t\t\t}\n\t\t});\n\t\t\n\t\t// go one step back\n\t\tthis.root.on('click', '#prev_step', function()\n\t\t{\n\t\t\twindow.location = self.getPrevUrl();\n\t\t});\n\t\t\n\t\t// Advanced settings button on the top of the page\n\t\t$('.dx-adv-btn').click(function()\n\t\t{\n\t\t\tview_list_item('form', self.options.list_id, 3, 0, 0, \"\", \"\", {\n\t\t\t\tafter_close: function()\n\t\t\t\t{\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\t\n\tgetStepNumber: function()\n\t{\n\t\treturn this.options.steps.indexOf(this.options.step);\n\t},\n\t\n\tgetCurrentUrl: function()\n\t{\n\t\tif(!this.options.list_id)\n\t\t{\n\t\t\treturn this.options.url;\n\t\t}\n\t\t\n\t\tif(this.options.step == 'names')\n\t\t{\n\t\t\treturn this.options.url + '/' + this.options.list_id;\n\t\t}\n\t\t\n\t\treturn this.options.url + '/' + this.options.list_id + '/' + this.options.step;\n\t},\n\t\n\tgetNextUrl: function(list_id)\n\t{\n\t\tif(this.getStepNumber() + 1 == this.options.steps.length)\n\t\t{\n\t\t\treturn this.options.last_url + this.options.view_id;\n\t\t}\n\t\t\n\t\tlist_id = typeof list_id !== 'undefined' ? list_id : this.options.list_id;\n\t\t\n\t\treturn this.options.url + '/' + list_id + '/' + this.options.steps[this.getStepNumber() + 1];\n\t},\n\t\n\tgetPrevUrl: function()\n\t{\n\t\tif(this.getStepNumber() == 1)\n\t\t{\n\t\t\treturn this.options.url + '/' + this.options.list_id;\n\t\t}\n\t\t\n\t\treturn this.options.url + '/' + this.options.list_id + '/' + this.options.steps[this.getStepNumber() - 1];\n\t},\n\t\n\tinit_columns: function()\n\t{\n\t\tvar self = this;\n\t\t\n\t\t$(\".dx-view-edit-form\").ViewEditor({\n\t\t\tview_container: $(\"#view_editor\"),\n\t\t\treloadBlockGrid: null,\n\t\t\troot_url: getBaseUrl(),\n\t\t\tload_tab_grid: null,\n\t\t\tonsave: function()\n\t\t\t{\n\t\t\t\twindow.location = self.getNextUrl();\n\t\t\t}\n\t\t});\n\t\t\n\t\tthis.viewEditor = $(\".dx-view-edit-form\").data('ViewEditor');\n\t\t\n\t\t$('.dx-new-field').click(function()\n\t\t{\n\t\t\tnew_list_item(7, 17, self.options.list_id, \"\", \"\", {\n\t\t\t\tafter_close: function(frm)\n\t\t\t\t{\n\t\t\t\t\tvar item_id = $(frm).find('input[name=\"item_id\"]').val();\n\t\t\t\t\tvar item_name = $(frm).find('input[name=\"title_list\"]').val();\n\t\t\t\t\t\n\t\t\t\t\tif(item_id == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar item = $(\n\t\t\t\t\t\t'<li class=\"dd-item\" data-id=\"\" data-list-id=\"\" data-is-hidden=\"0\" data-operation-id=\"0\" data-criteria=\"\" data-field-type=\"varchar\" data-rel-list-id=\"\" data-rel-field-id=\"\" data-aggregation-id=\"0\">' +\n\t\t\t\t\t\t'<div class=\"dd-handle dd3-handle\"> </div>' +\n\t\t\t\t\t\t'<div class=\"dd3-content\">' +\n\t\t\t\t\t\t'<div class=\"row\">' +\n\t\t\t\t\t\t'<div class=\"col-md-10\">' +\n\t\t\t\t\t\t'<b class=\"dx-fld-title\"></b>' +\n\t\t\t\t\t\t'<i class=\"fa fa-filter dx-icon-filter\"></i>' +\n\t\t\t\t\t\t'<i class=\"fa fa-eye-slash dx-icon-hidden\"></i>' +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'<div class=\"col-md-2\">' +\n\t\t\t\t\t\t'<a href=\"javascript:;\" title=\"' + Lang.get('grid.btn_remove_fld') + '\" class=\"pull-right dx-cms-field-remove\"><i class=\"fa fa-trash-o\"></i></a>' +\n\t\t\t\t\t\t'<a href=\"javascript:;\" title=\"' + Lang.get('grid.btn_add_fld') + '\" class=\"pull-right dx-cms-field-add\"><i class=\"fa fa-plus-square-o\"></i></a>' +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'</li>'\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\titem.attr('data-id', item_id);\n\t\t\t\t\titem.attr('data-list-id', self.options.list_id);\n\t\t\t\t\titem.find('.dx-fld-title').text(item_name);\n\t\t\t\t\t\n\t\t\t\t\titem.appendTo('.dd.dx-available .dd-list');\n\t\t\t\t\t\n\t\t\t\t\titem.find('[title]').tooltipster({\n\t\t\t\t\t\ttheme: 'tooltipster-light',\n\t\t\t\t\t\tanimation: 'grow'\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tself.viewEditor.setFldEventHandlers(self.viewEditor.frm_el, item, self.viewEditor.options.view_container);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\t\n\tinit_fields: function()\n\t{\n\t\tvar self = this;\n\t\t\n\t\tthis.root.find('.dx-constructor-tab-buttons').ConstructorTabs({\n\t\t\tform_id: this.options.form_id,\n\t\t\tlist_id: this.options.list_id\n\t\t});\n\t\t\n\t\tthis.root.find('.dx-constructor-grid').ConstructorGrid({\n\t\t\tlist_id: this.options.list_id\n\t\t});\n\t\t\n\t\t// handle row creation\n\t\tthis.root.find('.dx-add-row-btn').click(function()\n\t\t{\n\t\t\tif($(this).parents('.dx-constructor-tabs').length)\n\t\t\t{\n\t\t\t\tvar tab = self.root.find('.dx-constructor-tab:visible');\n\t\t\t\t\n\t\t\t\tif(tab.hasClass('related-grid'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\ttab.find('.dx-constructor-grid').data('ConstructorGrid').createRow();\n\t\t\t\t\n\t\t\t\t// window.scrollTo(0, document.body.scrollHeight);\n\t\t\t}\n\t\t\t\n\t\t\telse\n\t\t\t{\n\t\t\t\tself.root.find('.dx-constructor-form .dx-constructor-grid').data('ConstructorGrid').createRow();\n\t\t\t}\n\t\t});\n\t\t\n\t\t$('.dx-preview-btn').click(function()\n\t\t{\n\t\t\tself.submit_fields(function()\n\t\t\t{\n\t\t\t\tnew_list_item(self.options.list_id, 0, 0, \"\", \"\");\n\t\t\t});\n\t\t});\n\t},\n\t\n\tinit_rights: function()\n\t{\n\t\tvar self = this;\n\t\tvar rights = ['is_new_rights', 'is_edit_rights', 'is_delete_rights'];\n\t\tvar tbody = $('.dx-constructor-roles-table tbody');\n\t\t\n\t\tthis.root.on('click', '.dx-constructor-add-role', function()\n\t\t{\n\t\t\tnew_list_item(23, 105, self.options.list_id, \"\", \"\", {\n\t\t\t\tafter_close: function(frm)\n\t\t\t\t{\n\t\t\t\t\tvar role_id = $(frm).find('input[name=\"id\"]').val();\n\t\t\t\t\t\n\t\t\t\t\tif((typeof role_id == 'undefined') || role_id == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar role_name = $(frm).find('input[dx_fld_name=\"role_id\"]').val();\n\t\t\t\t\t\n\t\t\t\t\tvar tr = $(\n\t\t\t\t\t\t'<tr>' +\n\t\t\t\t\t\t'<td width=\"30%\">' +\n\t\t\t\t\t\t'<i class=\"fa fa-key\"></i> ' +\n\t\t\t\t\t\t'<a href=\"javascript:;\" class=\"dx-constructor-edit-role\" data-role_id=\"' + role_id + '\">' + role_name + '</a>' +\n\t\t\t\t\t\t'</td>' +\n\t\t\t\t\t\t'<td></td>' +\n\t\t\t\t\t\t'</tr>'\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\tvar td = tr.children('td').last();\n\t\t\t\t\t\n\t\t\t\t\tfor(var i = 0; i < rights.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar right = rights[i];\n\t\t\t\t\t\tvar input = $(frm).find('input[name=\"' + right + '\"]');\n\t\t\t\t\t\tif(input.length && input.prop('checked'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttd.append('<label class=\"badge badge-default\">' + Lang.get('constructor.' + right) + '</label> ');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\ttr.appendTo(tbody);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t\n\t\tthis.root.on('click', '.dx-constructor-edit-role', function()\n\t\t{\n\t\t\tvar a = $(this);\n\t\t\tvar td = $(this).closest('td').next();\n\t\t\tvar role_id = $(this).data('role_id');\n\t\t\t\n\t\t\tview_list_item('form', role_id, 23, 105, self.options.list_id, \"\", \"\", {\n\t\t\t\tafter_close: function(frm)\n\t\t\t\t{\n\t\t\t\t\ta.text($(frm).find('input[dx_fld_name=\"role_id\"]').val());\n\t\t\t\t\t\n\t\t\t\t\ttd.empty();\n\t\t\t\t\tfor(var i = 0; i < rights.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar right = rights[i];\n\t\t\t\t\t\tvar input = $(frm).find('input[name=\"' + right + '\"]');\n\t\t\t\t\t\tif(input.length && input.prop('checked'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttd.append('<label class=\"badge badge-default\">' + Lang.get('constructor.' + right) + '</label> ');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\t\n\tsubmit_names: function()\n\t{\n\t\tvar self = this;\n\t\tvar listName = this.root.find('#list_name');\n\t\tvar itemName = this.root.find('#item_name');\n\t\tvar menuParentID = this.root.find('input[name=parent_id]');\n\t\t\n\t\tif(listName.length && !listName.val())\n\t\t{\n\t\t\ttoastr.error(Lang.get('constructor.enter_name'));\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tif(itemName.length && !itemName.val())\n\t\t{\n\t\t\ttoastr.error(Lang.get('constructor.enter_item_name'));\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tshow_page_splash(1);\n\t\t\n\t\tvar request = {\n\t\t\tlist_name: listName.val(),\n\t\t\titem_name: itemName.val(),\n\t\t\tmenu_parent_id: menuParentID.val()\n\t\t};\n\t\t\n\t\tif(this.options.list_id)\n\t\t{\n\t\t\trequest._method = 'put';\n\t\t}\n\t\t\n\t\t$.ajax({\n\t\t\ttype: 'post',\n\t\t\turl: this.getCurrentUrl(),\n\t\t\tdataType: 'json',\n\t\t\tdata: request,\n\t\t\tsuccess: function(data)\n\t\t\t{\n\t\t\t\thide_page_splash(1);\n\t\t\t\t\n\t\t\t\twindow.location = self.getNextUrl(data.list_id);\n\t\t\t},\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\n\t\t\t{\n\t\t\t\tconsole.log(textStatus);\n\t\t\t\tconsole.log(jqXHR);\n\t\t\t\thide_page_splash(1);\n\t\t\t}\n\t\t});\n\t},\n\t\n\tsubmit_columns: function()\n\t{\n\t\t$(\".dx-view-edit-form\").data('ViewEditor').save();\n\t},\n\t\n\tsubmit_fields: function(onSuccess)\n\t{\n\t\tvar self = this;\n\t\t\n\t\tshow_page_splash(1);\n\t\t\n\t\tvar request = {\n\t\t\t_method: 'put',\n\t\t\ttabs: [],\n\t\t\titems: []\n\t\t};\n\t\t\n\t\tthis.root.find('.dx-constructor-tab-buttons .dd-item').each(function()\n\t\t{\n\t\t\trequest.tabs.push($(this).data('id'));\n\t\t});\n\t\t\n\t\tthis.root.find('.dx-constructor-form, .dx-constructor-tab.custom-data').each(function()\n\t\t{\n\t\t\tvar tab = [];\n\t\t\t\n\t\t\t$(this).find('.dx-constructor-grid .columns').each(function()\n\t\t\t{\n\t\t\t\tvar row = [];\n\t\t\t\t\n\t\t\t\t$(this).find('.dd-item').each(function()\n\t\t\t\t{\n\t\t\t\t\trow.push($(this).data('id'));\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif(row.length)\n\t\t\t\t{\n\t\t\t\t\ttab.push(row);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif(tab.length)\n\t\t\t{\n\t\t\t\trequest.items[$(this).data('tabId')] = tab;\n\t\t\t}\n\t\t});\n\t\t\n\t\t$.ajax({\n\t\t\ttype: 'post',\n\t\t\turl: this.getCurrentUrl(),\n\t\t\tdataType: 'json',\n\t\t\tdata: request,\n\t\t\tsuccess: function(data)\n\t\t\t{\n\t\t\t\t$('.dx-constructor-grid .dd-item.not-in-form').removeClass('not-in-form');\n\t\t\t\t$('.dx-fields-container .dd-item').addClass('not-in-form');\n\t\t\t\t\n\t\t\t\tif(typeof onSuccess === 'function')\n\t\t\t\t{\n\t\t\t\t\tonSuccess();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\twindow.location = self.getNextUrl();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\thide_page_splash(1);\n\t\t\t},\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\n\t\t\t{\n\t\t\t\tconsole.log(textStatus);\n\t\t\t\tconsole.log(jqXHR);\n\t\t\t\thide_page_splash(1);\n\t\t\t}\n\t\t});\n\t},\n\t\n\tsubmit_rights: function()\n\t{\n\t\twindow.location = this.getNextUrl();\n\t}\n});\n"]}