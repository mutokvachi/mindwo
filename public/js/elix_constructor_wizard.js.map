{"version":3,"sources":["view_editor.js","constructor_tabs.js","constructor_grid.js","constructor_wizard.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"elix_constructor_wizard.js","sourcesContent":["(function($)\r\n{\r\n\t/**\r\n\t * ViewEditor - a jQuery plugin that inits view editor functionality (columns setting by drag & drop)\r\n\t *\r\n\t * @param root\r\n\t * @returns {*}\r\n\t * @constructor\r\n\t */\r\n\t$.fn.ViewEditor = function(opts)\r\n\t{\r\n\t\tvar options = $.extend({}, $.fn.ViewEditor.defaults, opts);\r\n\t\treturn this.each(function()\r\n\t\t{\r\n\t\t\tnew $.ViewEditor(this, options);\r\n\t\t});\r\n\t};\r\n\t\r\n\t$.fn.ViewEditor.defaults = {\r\n\t\tview_container: null,\r\n\t\treloadBlockGrid: null,\r\n\t\troot_url: \"/\",\r\n\t\tload_tab_grid: null,\r\n\t\tonsave: null\r\n\t};\r\n\t\r\n\t/**\r\n\t * ViewEditor constructor\r\n\t *\r\n\t * @param root\r\n\t * @constructor\r\n\t */\r\n\t$.ViewEditor = function(root, opts)\r\n\t{\r\n\t\t$.data(root, 'ViewEditor', this);\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tthis.options = opts;\r\n\t\tthis.root = $(root);\r\n\t\t\r\n\t\tif(this.root.hasClass(\"is-init\"))\r\n\t\t{\r\n\t\t\treturn; // editor is allready initialized\r\n\t\t}\r\n\t\t\r\n\t\tthis.root.find(\".dx-cms-nested-list\").nestable();\r\n\t\t\r\n\t\tthis.handleBtnSaveView(this.options.view_container);\r\n\t\tthis.handleBtnCopy(this.options.view_container);\r\n\t\tthis.handleBtnDelete(this.options.view_container);\r\n\t\tthis.handleFieldOperation(this.options.view_container);\r\n\t\t\r\n\t\tvar frm_el = this.root.closest(\".dx-popup-modal\");\r\n\t\t\r\n\t\tthis.frm_el = frm_el;\r\n\t\t\r\n\t\tthis.setFldEventHandlers(frm_el, frm_el, this.options.view_container);\r\n\t\tthis.handleSearchField();\r\n\t\tthis.handleIsMyCheck(this.root);\r\n\t\t\r\n\t\tthis.root.find(\".dx-view-btn-copy\").show();\r\n\t\tthis.root.find(\".dx-view-btn-delete\").show();\r\n\t\t\r\n\t\tthis.root.addClass(\"is-init\");\r\n\t};\r\n\t\r\n\t/**\r\n\t * InlineForm methods\r\n\t */\r\n\t$.extend($.ViewEditor.prototype, {\r\n\t\t\r\n\t\t/**\r\n\t\t * Sets events for added/moved field\r\n\t\t *\r\n\t\t * @param {object} frm_el Fields UI forms HTML object\r\n\t\t * @param {object} fld_el Field element HTML object\r\n\t\t * @param {object} view_container Grid view main object's HTML element\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\tsetFldEventHandlers: function(frm_el, fld_el, view_container)\r\n\t\t{\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\t\t\tfld_el.find('.dx-cms-field-remove').click(function()\r\n\t\t\t{\r\n\t\t\t\tself.removeFld(frm_el, $(this), view_container);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tfld_el.find('.dx-cms-field-add').click(function()\r\n\t\t\t{\r\n\t\t\t\tself.addFld(frm_el, $(this), view_container);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tfld_el.find('.dx-fld-title').click(function()\r\n\t\t\t{\r\n\t\t\t\tself.openSettings($(this), view_container);\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Moves field from used section to available fields section\r\n\t\t *\r\n\t\t * @param {object} frm_el Fields UI forms HTML object\r\n\t\t * @param {object} fld_el Field element HTML object\r\n\t\t * @param {object} view_container Grid view main object's HTML element\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\tremoveFld: function(frm_el, fld_el, view_container)\r\n\t\t{\r\n\t\t\tfrm_el.find('.dx-fields-container .dx-available ol.dd-list').append(fld_el.closest('.dd-item').clone());\r\n\t\t\tfld_el.closest('.dd-item').remove();\r\n\t\t\t\r\n\t\t\tvar new_el = frm_el.find('.dx-fields-container .dx-available ol.dd-list .dd-item').last();\r\n\t\t\tthis.setFldEventHandlers(frm_el, new_el, view_container);\r\n\t\t\t\r\n\t\t\tthis.clearSearchIfLast(frm_el, 'dx-used');\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Moves field from available section to used fields section\r\n\t\t *\r\n\t\t * @param {object} frm_el Fields UI forms HTML object\r\n\t\t * @param {object} fld_el Field element HTML object\r\n\t\t * @param {object} view_container Grid view main object's HTML element\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\taddFld: function(frm_el, fld_el, view_container)\r\n\t\t{\r\n\t\t\tfrm_el.find('.dx-fields-container .dx-used ol.dd-list').append(fld_el.closest('.dd-item').clone());\r\n\t\t\tfld_el.closest('.dd-item').remove();\r\n\t\t\t\r\n\t\t\tvar new_el = frm_el.find('.dx-fields-container .dx-used ol.dd-list .dd-item').last();\r\n\t\t\tthis.setFldEventHandlers(frm_el, new_el, view_container);\r\n\t\t\t\r\n\t\t\tthis.clearSearchIfLast(frm_el, 'dx-available');\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Sets handles for checkboxies (is default and is my view only)\r\n\t\t *\r\n\t\t * @param {object} frm_el Fields UI forms HTML object\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\thandleIsMyCheck: function(frm_el)\r\n\t\t{\r\n\t\t\tfrm_el.find(\"input[name=is_my_view]\").change(function()\r\n\t\t\t{\r\n\t\t\t\tif($(this).prop('checked'))\r\n\t\t\t\t{\r\n\t\t\t\t\tfrm_el.find(\"input[name=is_default]\").prop('checked', '').closest('span').hide();\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tfrm_el.find(\"input[name=is_default]\").closest('span').show();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tfrm_el.find(\"input[name=is_default]\").change(function()\r\n\t\t\t{\r\n\t\t\t\tif($(this).prop('checked'))\r\n\t\t\t\t{\r\n\t\t\t\t\tfrm_el.find(\"input[name=is_my_view]\").prop('checked', '').closest('span').hide();\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tfrm_el.find(\"input[name=is_my_view]\").closest('span').show();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Clear fields search input in case if no more fields in container (and show again all fields in container)\r\n\t\t *      *\r\n\t\t * @param {object} frm_el Fields UI forms HTML object\r\n\t\t * @param {string} fields_class HTML class name of fields container (dx-used or dx-available)\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\tclearSearchIfLast: function(frm_el, fields_class)\r\n\t\t{\r\n\t\t\tif(frm_el.find('.dx-fields-container .' + fields_class + ' ol.dd-list .dd-item:visible').length == 0)\r\n\t\t\t{\r\n\t\t\t\tvar txt = frm_el.find('.dx-fields-container .' + fields_class).closest('.portlet').find('input.dx-search');\r\n\t\t\t\tif(txt.val().length > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\ttxt.val('');\r\n\t\t\t\t\ttxt.closest(\".portlet\").find(\".dx-fields-container .dd-item\").show();\r\n\t\t\t\t\ttxt.focus();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Opens field's setting form\r\n\t\t *\r\n\t\t * @param {object} title_el Field item title HTML element\r\n\t\t * @param {object} view_container Grid view main object's HTML element\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\topenSettings: function(title_el, view_container)\r\n\t\t{\r\n\t\t\tif(title_el.closest('.dx-cms-nested-list').hasClass('dx-used'))\r\n\t\t\t{\r\n\t\t\t\tvar item = title_el.closest('.dd-item');\r\n\t\t\t\tvar sett_el = view_container.find('.dx-popup-modal-settings');\r\n\t\t\t\t\r\n\t\t\t\tsett_el.find(\"input[name=is_hidden]\").prop(\"checked\", (item.attr(\"data-is-hidden\") == \"1\") ? \"checked\" : \"\");\r\n\t\t\t\tsett_el.find(\"input[name=field_title]\").val(title_el.text());\r\n\t\t\t\tsett_el.find(\"select[name=field_operation]\").val(item.attr(\"data-operation-id\"));\r\n\t\t\t\t\r\n\t\t\t\tif(item.attr(\"data-field-type\") == \"autocompleate\" || item.attr(\"data-field-type\") == \"rel_id\")\r\n\t\t\t\t{\r\n\t\t\t\t\tsett_el.find(\"select[name=field_operation]\").attr(\"data-criteria\", \"auto\");\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar auto_fld = sett_el.find(\"div.dx-autocompleate-field\");\r\n\t\t\t\t\tauto_fld.attr(\"data-rel-list-id\", item.attr('data-rel-list-id'));\r\n\t\t\t\t\tauto_fld.attr(\"data-rel-field-id\", item.attr('data-rel-field-id'));\r\n\t\t\t\t\tauto_fld.attr(\"data-item-value\", item.attr('data-criteria'));\r\n\t\t\t\t\tauto_fld.attr(\"data-field-id\", item.attr('data-id'));\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar formData = new FormData();\r\n\t\t\t\t\tformData.append(\"list_id\", item.attr('data-rel-list-id'));\r\n\t\t\t\t\tformData.append(\"txt_field_id\", item.attr('data-rel-field-id'));\r\n\t\t\t\t\tformData.append(\"txt_field_id\", item.attr('data-rel-field-id'));\r\n\t\t\t\t\tformData.append(\"value_id\", item.attr('data-criteria'));\r\n\t\t\t\t\t\r\n\t\t\t\t\tshow_form_splash();\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\turl: DX_CORE.site_url + \"view/auto_data\",\r\n\t\t\t\t\t\tdata: formData,\r\n\t\t\t\t\t\tprocessData: false,\r\n\t\t\t\t\t\tcontentType: false,\r\n\t\t\t\t\t\tdataType: \"json\",\r\n\t\t\t\t\t\tasync: false,\r\n\t\t\t\t\t\tsuccess: function(data)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\thide_form_splash();\r\n\t\t\t\t\t\t\tauto_fld.attr(\"data-min-length\", data['count']);\r\n\t\t\t\t\t\t\tauto_fld.attr(\"data-item-text\", data['txt']);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tAutocompleateField.initSelect(auto_fld);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tsett_el.find(\"select[name=field_operation]\").attr(\"data-criteria\", \"text\");\r\n\t\t\t\t\tsett_el.find(\"input[name=criteria_value]\").val(item.attr(\"data-criteria\"));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.showHideCriteria(sett_el, sett_el.find(\"select[name=field_operation]\"));\r\n\t\t\t\t\r\n\t\t\t\tvar btn_save = sett_el.find('.dx-settings-btn-save');\r\n\t\t\t\t\r\n\t\t\t\tbtn_save.off(\"click\");\r\n\t\t\t\tbtn_save.click(function()\r\n\t\t\t\t{\r\n\t\t\t\t\tvar oper_el = sett_el.find('select[name=field_operation]');\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar crit_val = \"\";\r\n\t\t\t\t\tif(oper_el.attr(\"data-criteria\") == \"text\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcrit_val = sett_el.find('input[name=criteria_value]').val();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcrit_val = parseInt(sett_el.find('input.dx-auto-input-id').val());\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(oper_el.val() && oper_el.find('option:selected').attr('data-is-criteria') != \"0\" && !crit_val)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnotify_err(Lang.get('grid.error_filter_must_be_set'));\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\titem.attr(\"data-criteria\", crit_val);\r\n\t\t\t\t\titem.attr(\"data-is-hidden\", sett_el.find('input[name=is_hidden]').is(\":checked\") ? 1 : 0);\r\n\t\t\t\t\titem.attr(\"data-operation-id\", oper_el.val());\r\n\t\t\t\t\t\r\n\t\t\t\t\tsett_el.modal('hide');\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tsett_el.modal('show');\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Handles event for show or hide criteria field depending on selected operation\r\n\t\t *\r\n\t\t * @param {object} view_container Grid view main object's HTML element\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\thandleFieldOperation: function(view_container)\r\n\t\t{\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\t\t\tvar sett_el = view_container.find('.dx-popup-modal-settings');\r\n\t\t\tsett_el.find('select[name=field_operation]').change(function()\r\n\t\t\t{\r\n\t\t\t\tself.showHideCriteria(sett_el, $(this));\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Shoe or hide criteria field depending on selected operation\r\n\t\t * @param {object} sett_el Setting popup form HTML element\r\n\t\t * @param {object} sel_el Operation select HTML element\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\tshowHideCriteria: function(sett_el, sel_el)\r\n\t\t{\r\n\t\t\tif(sel_el.find('option:selected').attr('data-is-criteria') != \"0\")\r\n\t\t\t{\r\n\t\t\t\tif(sel_el.attr(\"data-criteria\") == \"text\")\r\n\t\t\t\t{\r\n\t\t\t\t\tsett_el.find(\".dx-criteria-text\").show();\r\n\t\t\t\t\tsett_el.find(\".dx-criteria-auto\").hide();\r\n\t\t\t\t\tsett_el.find(\"input[name=criteria_value]\").focus();\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tsett_el.find(\".dx-criteria-text\").hide();\r\n\t\t\t\t\tsett_el.find(\".dx-criteria-auto\").show();\r\n\t\t\t\t\tsett_el.find('.dx-auto-input-select2').select2(\"open\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tsett_el.find(\"input[name=criteria_value]\").val('');\r\n\t\t\t\tsett_el.find(\".dx-criteria-auto\").hide();\r\n\t\t\t\tsett_el.find(\".dx-criteria-text\").hide();\r\n\t\t\t\tsett_el.find('.dx-auto-input-select2').select2('data', {id: 0, text: \"\"});\r\n\t\t\t\tsett_el.find(\"input.dx-auto-input-id\").val(0);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Handles fields searching functionality\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\thandleSearchField: function()\r\n\t\t{\r\n\t\t\t$(\"input.dx-search\").on(\"keyup\", function()\r\n\t\t\t{\r\n\t\t\t\tif(!$(this).val())\r\n\t\t\t\t{\r\n\t\t\t\t\t$(this).closest(\".portlet\").find(\".dx-fields-container .dd-item\").show();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t$(this).closest(\".portlet\").find(\".dx-fields-container .dd-item\").hide();\r\n\t\t\t\t$(this).closest(\".portlet\").find(\".dx-fields-container .dx-fld-title:contains('\" + $(this).val() + \"')\").closest(\".dd-item\").show();\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Handles view copy function\r\n\t\t *\r\n\t\t * @param {object} view_container Grid view main object's HTML element\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\thandleBtnCopy: function(view_container)\r\n\t\t{\r\n\t\t\tvar pop_el = $(\"#\" + view_container.attr(\"id\") + \"_popup\");\r\n\t\t\tpop_el.find(\".dx-view-btn-copy\").click(function()\r\n\t\t\t{\r\n\t\t\t\tvar frm_el = pop_el.find(\".dx-view-edit-form\");\r\n\t\t\t\tfrm_el.data('view-id', 0);\r\n\t\t\t\tpop_el.find(\".dx-view-btn-copy\").hide();\r\n\t\t\t\tpop_el.find(\".dx-view-btn-delete\").hide();\r\n\t\t\t\tpop_el.find(\"span.badge\").html(Lang.get('grid.badge_new'));\r\n\t\t\t\tfrm_el.find(\"input[name=view_title]\").val(frm_el.find(\"input[name=view_title]\").val() + \" - \" + Lang.get('grid.title_copy')).focus();\r\n\t\t\t\t\r\n\t\t\t\tfrm_el.find('input[name=is_default]').prop(\"checked\", '').show().closest('span').show();\r\n\t\t\t\tfrm_el.find('input[name=is_my_view]').prop(\"checked\", '').closest('span').show();\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Handles button \"Delete\" pressing\r\n\t\t *\r\n\t\t * @param {object} view_container Grid view main object's HTML element\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\thandleBtnDelete: function(view_container)\r\n\t\t{\r\n\t\t\tvar self = this;\r\n\t\t\tvar pop_el = $(\"#\" + view_container.attr(\"id\") + \"_popup\");\r\n\t\t\tpop_el.find(\".dx-view-btn-delete\").click(function()\r\n\t\t\t{\r\n\t\t\t\tPageMain.showConfirm(self.deleteView, {\r\n\t\t\t\t\tview_container: view_container,\r\n\t\t\t\t\tself: self\r\n\t\t\t\t}, null, Lang.get('grid.confirm_delete'), Lang.get('form.btn_yes'), Lang.get('form.btn_no'));\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Loads view after previous view deletion or new view creation\r\n\t\t *\r\n\t\t * @param {object} view_container Grid view main object's HTML element\r\n\t\t * @param {integer} view_id View ID\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\treloadAnotherView: function(view_container, view_id)\r\n\t\t{\r\n\t\t\tif(view_container.attr('dx_tab_id'))\r\n\t\t\t{\r\n\t\t\t\tif(this.options.load_tab_grid)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.options.load_tab_grid(view_container.attr('dx_tab_id'), view_container.attr('dx_list_id'), view_id, view_container.attr('dx_rel_field_id'), view_container.attr('dx_rel_field_value'), view_container.attr('dx_form_htm_id'), 1, 5, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tshow_page_splash(1);\r\n\t\t\t\tvar url = this.options.root_url + 'skats_' + view_id;\r\n\t\t\t\twindow.location.assign(encodeURI(url));\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Handles view deletion functionality\r\n\t\t *\r\n\t\t * @param {object} view_container Grid view main object's HTML element\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\tdeleteView: function(params)\r\n\t\t{\r\n\t\t\tvar self = params.self;\r\n\t\t\tvar view_container = params.view_container;\r\n\t\t\t\r\n\t\t\tvar pop_el = $(\"#\" + view_container.attr(\"id\") + \"_popup\");\r\n\t\t\tvar frm_el = pop_el.find(\".dx-view-edit-form\");\r\n\t\t\t\r\n\t\t\tvar formData = new FormData();\r\n\t\t\tformData.append(\"view_id\", frm_el.data('view-id'));\r\n\t\t\tformData.append(\"list_id\", frm_el.data('list-id'));\r\n\t\t\tformData.append('tab_id', view_container.attr('dx_tab_id'));\r\n\t\t\t\r\n\t\t\tvar request = new FormAjaxRequest('view/delete', \"\", \"\", formData);\r\n\t\t\trequest.progress_info = true;\r\n\t\t\t\r\n\t\t\trequest.callback = function(data)\r\n\t\t\t{\r\n\t\t\t\tif(data[\"success\"] == 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tpop_el.modal('hide');\r\n\t\t\t\t\tself.reloadAnotherView(view_container, data[\"view_id\"]);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t// execute AJAX request\r\n\t\t\trequest.doRequest();\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Prepares JSON string with all fields included in view (in correct order)\r\n\t\t *\r\n\t\t * @param {object} block Fields container HTML element\r\n\t\t * @returns {string}\r\n\t\t */\r\n\t\tgetFieldsState: function(block)\r\n\t\t{\r\n\t\t\tvar ret_arr = new Array();\r\n\t\t\t\r\n\t\t\tblock.find(\".dd-item\").each(function()\r\n\t\t\t{\r\n\t\t\t\tvar item = {\r\n\t\t\t\t\t\"field_id\": $(this).attr('data-id'),\r\n\t\t\t\t\t\"aggregation_id\": $(this).attr('data-aggregation-id'),\r\n\t\t\t\t\t\"list_id\": $(this).attr('data-list-id'),\r\n\t\t\t\t\t\"is_hidden\": $(this).attr('data-is-hidden'),\r\n\t\t\t\t\t\"operation_id\": $(this).attr('data-operation-id'),\r\n\t\t\t\t\t\"criteria\": $(this).attr('data-criteria')\r\n\t\t\t\t};\r\n\t\t\t\tret_arr.push(item);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\treturn JSON.stringify(ret_arr);\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Handles button event - save view data\r\n\t\t *\r\n\t\t * @param {object} view_container Grid view main object's HTML element\r\n\t\t * @returns {undefined}\r\n\t\t */\r\n\t\thandleBtnSaveView: function(view_container)\r\n\t\t{\r\n\t\t\tvar self = this;\r\n\t\t\tvar pop_el = $(\"#\" + view_container.attr(\"id\") + \"_popup\");\r\n\t\t\tpop_el.find(\".dx-view-btn-save\").click(function()\r\n\t\t\t{\r\n\t\t\t\tself.save();\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * Save view data. Can be invoked externally.\r\n\t\t */\r\n\t\tsave: function()\r\n\t\t{\r\n\t\t\tvar self = this;\r\n\t\t\tvar view_container = this.options.view_container;\r\n\t\t\tvar pop_el = $(\"#\" + view_container.attr(\"id\") + \"_popup\");\r\n\t\t\tvar frm_el = pop_el.find(\".dx-view-edit-form\");\r\n\t\t\tvar view_id = frm_el.data('view-id');\r\n\t\t\tvar grid_el = view_container.find('.dx-grid-table').last();\r\n\t\t\t\r\n\t\t\tvar formData = new FormData();\r\n\t\t\tformData.append(\"view_id\", view_id);\r\n\t\t\tformData.append(\"list_id\", frm_el.data('list-id'));\r\n\t\t\tformData.append(\"view_title\", frm_el.find('input[name=view_title]').val());\r\n\t\t\tformData.append(\"is_default\", frm_el.find('input[name=is_default]').is(\":checked\") ? 1 : 0);\r\n\t\t\tformData.append(\"is_my_view\", frm_el.find('input[name=is_my_view]').is(\":checked\") ? 1 : 0);\r\n\t\t\tformData.append(\"fields\", self.getFieldsState(frm_el.find('.dx-fields-container .dx-used')));\r\n\t\t\tformData.append('grid_id', grid_el.attr('id'));\r\n\t\t\t\r\n\t\t\tvar request = new FormAjaxRequest('view/save', \"\", \"\", formData);\r\n\t\t\trequest.progress_info = true;\r\n\t\t\t\r\n\t\t\trequest.callback = function(data)\r\n\t\t\t{\r\n\t\t\t\tif(data[\"success\"] == 1)\r\n\t\t\t\t{\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(self.options.onsave)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tself.options.onsave.call(this, data[\"view_id\"]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpop_el.modal('hide');\r\n\t\t\t\t\t\tpop_el.attr(\"id\", pop_el.attr(\"id\") + \"_\" + $(\".dx-popup-modal\").length);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(view_id == 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tself.reloadAnotherView(view_container, data[\"view_id\"]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif(self.options.reloadBlockGrid)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tself.options.reloadBlockGrid(grid_el.attr('id'), grid_el.data('tab_id'));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t// execute AJAX request\r\n\t\t\trequest.doRequest();\r\n\t\t}\r\n\t});\r\n\t\r\n})(jQuery);\r\n\r\n$(document).ajaxComplete(function(event, xhr, settings)\r\n{\r\n\t$(\"input.dx-bool\").ViewEditor();\r\n});\r\n\r\n$(document).ready(function()\r\n{\r\n\t$(\"input.dx-bool\").ViewEditor();\r\n});","/**\r\n * ConstructorTabs - manages form tabs.\r\n */\r\nModule.create('ConstructorTabs', {\r\n\t/**\r\n\t * Default values of options\r\n\t */\r\n\tdefaults: {\r\n\t\tform_id: 0,\r\n\t\tlist_id: 0,\r\n\t\trelatedHtml: ''\r\n\t},\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstruct: function() {\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tthis.activeTabButton = $('.dx-constructor-tab-button').first().addClass('active');\r\n\t\tthis.activeTab = $('.dx-constructor-tab').first();\r\n\t\tthis.tabAddRowBtn = $('.dx-constructor-tabs .dx-add-row-btn');\r\n\t\t\r\n\t\tthis.activeTab.hasClass('related-grid') && this.tabAddRowBtn.hide();\r\n\t\t\r\n\t\tthis.root.find('.dd-list').sortable({\r\n\t\t\tcontainment: 'parent'\r\n\t\t});\r\n\t\t\r\n\t\tthis.root.on('click', '.dd-item a.title', function() {\r\n\t\t\tself.activate($(this).closest('.dd-item'));\r\n\t\t});\r\n\t\t\r\n\t\tthis.root.find('.dd-item.custom-data').each(function() {\r\n\t\t\tself.initButton($(this));\r\n\t\t});\r\n\t\t\r\n\t\t$('.dx-tab-add-btn').click(function() {\r\n\t\t\tself.add();\r\n\t\t});\r\n\t\t\r\n\t\t$('.dx-tab-edit-btn').click(function() {\r\n\t\t\tself.edit();\r\n\t\t});\r\n\t\t\r\n\t\t$('.dx-tab-delete-btn').click(function() {\r\n\t\t\tself.del();\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * Initialize droppable plugin for specified tab button.\r\n\t * @param button\r\n\t */\r\n\tinitButton(button)\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tvar timer;\r\n\t\t\r\n\t\tbutton.droppable({\r\n\t\t\taccept: '.dx-field, .dx-constructor-row',\r\n\t\t\ttolerance: 'pointer',\r\n\t\t\tover: function(event, ui) {\r\n\t\t\t\tvar tab = $(this);\r\n\t\t\t\t\r\n\t\t\t\ttimer = setTimeout(function() {\r\n\t\t\t\t\tself.activate(tab)\r\n\t\t\t\t}, 1000)\r\n\t\t\t},\r\n\t\t\tout: function(event, ui) {\r\n\t\t\t\tclearTimeout(timer);\r\n\t\t\t},\r\n\t\t\tdeactivate: function(event, ui) {\r\n\t\t\t\tclearTimeout(timer);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * Activate specified tab\r\n\t * @param tab\r\n\t */\r\n\tactivate: function(tab) {\r\n\t\t$('.dx-constructor-tab:visible').hide();\r\n\t\t\r\n\t\tthis.root.find('.dx-constructor-tab-button').removeClass('active');\r\n\t\t\r\n\t\tthis.activeTabButton = tab;\r\n\t\tthis.activeTabButton.addClass('active');\r\n\t\t\r\n\t\tthis.activeTab = $('.dx-constructor-tab.tab-id-' + tab.data('id')).show();\r\n\t\t\r\n\t\tif(tab.hasClass('custom-data'))\r\n\t\t{\r\n\t\t\tthis.activeTab.find('.dx-constructor-grid').data('ConstructorGrid').updateGrid();\r\n\t\t\tthis.tabAddRowBtn.show();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.tabAddRowBtn.hide();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Handler for Add tab button\r\n\t */\r\n\tadd: function() {\r\n\t\tvar self = this;\r\n\t\topen_form('form', 0, 16, 66, this.options.form_id, \"\", 1, \"\", {\r\n\t\t\tbefore_show: function(frm) {\r\n\t\t\t\tvar order_index = (($('.dx-constructor-tab-button').length + 1) * 10) + 10;\r\n\t\t\t\tfrm.find('input[name=\"order_index\"]').val(order_index).prop('disabled', true);\r\n\t\t\t},\r\n\t\t\tafter_close: function(frm) {\r\n\t\t\t\tvar id = frm.find('input[name=\"item_id\"]').val();\r\n\t\t\t\t\r\n\t\t\t\tif(id == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(!$('.dx-constructor-tab-button').length)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('.dx-constructor-form-tabs').show();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar title = frm.find('input[name=\"title\"]').val();\r\n\t\t\t\tvar order_index = frm.find('input[name=\"order_index\"]').val();\r\n\t\t\t\tvar is_custom_data = (frm.find('input[name=\"is_custom_data\"]').bootstrapSwitch('state'));\r\n\t\t\t\t\r\n\t\t\t\tvar button = $(self.options.tabButton);\r\n\t\t\t\tbutton.find('.title').text(title);\r\n\t\t\t\tbutton.addClass('tab-id-' + id);\r\n\t\t\t\tbutton.addClass(is_custom_data ? 'custom_data' : 'related-grid');\r\n\t\t\t\tbutton.attr('data-id', id);\r\n\t\t\t\tbutton.attr('data-order', order_index);\r\n\t\t\t\tbutton = button.appendTo('.dx-constructor-tab-buttons .dd-list');\r\n\t\t\t\t\r\n\t\t\t\tvar tab = $('<div class=\"dx-constructor-tab\" style=\"display: none\"></div>')\r\n\t\t\t\t\t.appendTo('.dx-constructor-tabs-wrap');\r\n\t\t\t\t\r\n\t\t\t\ttab.addClass('tab-id-' + id);\r\n\t\t\t\ttab.attr('data-tab-id', id);\r\n\t\t\t\ttab.attr('data-tab-title', title);\r\n\t\t\t\ttab.append('<h5>' + title + '</h5>');\r\n\t\t\t\t\r\n\t\t\t\tif(is_custom_data)\r\n\t\t\t\t{\r\n\t\t\t\t\ttab.addClass('custom-data');\r\n\t\t\t\t\t\r\n\t\t\t\t\tself.initButton(button);\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar grid = $('<div class=\"dx-constructor-grid\"></div>').appendTo(tab);\r\n\t\t\t\t\t\r\n\t\t\t\t\tgrid.ConstructorGrid({\r\n\t\t\t\t\t\tlist_id: self.options.list_id\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tgrid.data('ConstructorGrid').createRow('columns');\r\n\t\t\t\t\tgrid.data('ConstructorGrid').createRow('columns');\r\n\t\t\t\t\tgrid.data('ConstructorGrid').createRow('columns');\r\n\t\t\t\t\tgrid.data('ConstructorGrid').createRow('columns');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\ttab.addClass('related-grid');\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar html = $(self.options.relatedHtml);\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar tmp = frm.find('input[dx_fld_name=\"grid_list_id\"]');\r\n\t\t\t\t\ttmp.length && html.find('input[name=\"list_title\"]').val(tmp.val());\r\n\t\t\t\t\t\r\n\t\t\t\t\ttmp = frm.find('input[dx_fld_name=\"grid_list_field_id\"]');\r\n\t\t\t\t\ttmp.length && html.find('input[name=\"field_title\"]').val(tmp.val());\r\n\t\t\t\t\t\r\n\t\t\t\t\thtml.appendTo(tab);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tself.activate(button);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * Handler for Edit tab button\r\n\t */\r\n\tedit: function() {\r\n\t\tvar self = this;\r\n\t\tvar tab = this.activeTab;\r\n\t\tvar button = this.activeTabButton;\r\n\t\t\r\n\t\topen_form('form', tab.data('tabId'), 16, 66, this.options.form_id, \"\", 1, \"\", {\r\n\t\t\tbefore_show: function(frm) {\r\n\t\t\t\tfrm.find('input[name=\"order_index\"]').prop('disabled', true);\r\n\t\t\t\tfrm.find('input[name=\"is_custom_data\"]').bootstrapSwitch('toggleDisabled', true);\r\n\t\t\t},\r\n\t\t\tafter_close: function(frm) {\r\n\t\t\t\tif(frm.find('input[name=\"item_id\"]').val() == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar title = frm.find('input[name=\"title\"]').val();\r\n\t\t\t\tbutton.find('.title').text(title);\r\n\t\t\t\ttab.attr('data-tab-title', title);\r\n\t\t\t\ttab.children('h5').text(title);\r\n\t\t\t\t\r\n\t\t\t\tif(tab.hasClass('related-grid'))\r\n\t\t\t\t{\r\n\t\t\t\t\tvar tmp = frm.find('input[dx_fld_name=\"grid_list_id\"]');\r\n\t\t\t\t\ttmp.length && tab.find('input[name=\"list_title\"]').val(tmp.val());\r\n\t\t\t\t\t\r\n\t\t\t\t\ttmp = frm.find('input[dx_fld_name=\"grid_list_field_id\"]');\r\n\t\t\t\t\ttmp.length && tab.find('input[name=\"field_title\"]').val(tmp.val());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * Handler for Delete tab button\r\n\t */\r\n\tdel: function() {\r\n\t\tvar self = this;\r\n\t\tvar tab = this.activeTab;\r\n\t\tvar button = this.activeTabButton;\r\n\t\t\r\n\t\tif(tab.hasClass('custom-data') && (tab.find('.dx-constructor-row .dx-field').length > 0))\r\n\t\t{\r\n\t\t\ttoastr.info(Lang.get('constructor.tab_empty'));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar func = function() {\r\n\t\t\tvar request = {\r\n\t\t\t\t_method: 'delete',\r\n\t\t\t\tid: tab.data('tabId')\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$.ajax({\r\n\t\t\t\ttype: 'post',\r\n\t\t\t\turl: '/constructor/register/tab/' + tab.data('tabId'),\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: request,\r\n\t\t\t\tsuccess: function(data)\r\n\t\t\t\t{\r\n\t\t\t\t\thide_page_splash(1);\r\n\t\t\t\t\t\r\n\t\t\t\t\ttab.remove();\r\n\t\t\t\t\tbutton.remove();\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar buttons = $('.dx-constructor-tab-button');\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(buttons.length)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tself.activate(buttons.first());\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$('.dx-constructor-form-tabs').hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\ttoastr.success(Lang.get('constructor.tab_del_success'))\r\n\t\t\t\t},\r\n\t\t\t\terror: function(jqXHR, textStatus, errorThrown)\r\n\t\t\t\t{\r\n\t\t\t\t\tconsole.log(textStatus);\r\n\t\t\t\t\tconsole.log(jqXHR);\r\n\t\t\t\t\thide_page_splash(1);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\t\r\n\t\tPageMain.showConfirm(func, null,\r\n\t\t\tLang.get('constructor.confirm_action'),\r\n\t\t\tLang.get('constructor.tab_del_confirm'),\r\n\t\t\t''\r\n\t\t);\r\n\t}\r\n});\r\n","/**\r\n * ConstructorGrid - a plugin that manages grid of constructor and allows form to be designed\r\n * by dragging and dropping elements.\r\n */\r\nModule.create('ConstructorGrid', {\r\n\tdefaults: {\r\n\t\t'rowHtml': ''\r\n\t},\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstruct: function()\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tthis.wizard = $('.dx-constructor-wizard').data('ConstructorWizard');\r\n\t\t\r\n\t\tthis.fieldsContainer = $('.dx-fields-container .columns');\r\n\t\t\r\n\t\tthis.dialog = $('#fields_popup');\r\n\t\tthis.dialogId = this.dialog.find('[name=\"field_id\"]');\r\n\t\tthis.dialogField = this.dialog.find('[name=\"title_form\"]');\r\n\t\tthis.dialogHidden = this.dialog.find('[name=\"is_hidden\"]');\r\n\t\t\r\n\t\t// configuration of Sortable plugin for use inside of form rows\r\n\t\tthis.sortableOpts = {\r\n\t\t\tconnectWith: '.columns',\r\n\t\t\thandle: '.dd-handle',\r\n\t\t\tplaceholder: 'placeholder',\r\n\t\t\tforcePlaceholderSize: true,\r\n\t\t\tforceHelperSize: true,\r\n\t\t\tcursorAt: {\r\n\t\t\t\tleft: 30,\r\n\t\t\t\ttop: 15\r\n\t\t\t},\r\n\t\t\tover: function(event, ui)\r\n\t\t\t{\r\n\t\t\t\tself.updateGrid();\r\n\t\t\t},\r\n\t\t\tout: function(event, ui)\r\n\t\t\t{\r\n\t\t\t\tself.updateGrid();\r\n\t\t\t},\r\n\t\t\tdeactivate: function(event, ui)\r\n\t\t\t{\r\n\t\t\t\tself.updateRow($(this));\r\n\t\t\t},\r\n\t\t\tchange: function(event, ui)\r\n\t\t\t{\r\n\t\t\t\tself.updateGrid();\r\n\t\t\t},\r\n\t\t\treceive: function(event, ui)\r\n\t\t\t{\r\n\t\t\t\tif($(this).children().length > 4)\r\n\t\t\t\t{\r\n\t\t\t\t\t$(ui.sender).sortable('cancel');\r\n\t\t\t\t}\r\n\t\t\t\tself.updateGrid();\r\n\t\t\t},\r\n\t\t\thelper: this.sortHelper,\r\n\t\t\tstart: this.onSortStart,\r\n\t\t\tstop: this.onSortStop\r\n\t\t};\r\n\t\t\r\n\t\t// fields list at left side\r\n\t\tthis.fieldsContainer.sortable({\r\n\t\t\tconnectWith: '.columns',\r\n\t\t\thandle: '.dd-handle',\r\n\t\t\tplaceholder: 'placeholder',\r\n\t\t\tforcePlaceholderSize: true,\r\n\t\t\treceive: function(event, ui)\r\n\t\t\t{\r\n\t\t\t\t$(ui.item).attr('class', 'col-md-12');\r\n\t\t\t},\r\n\t\t\tstart: this.onSortStart,\r\n\t\t\tstop: this.onSortStop\r\n\t\t});\r\n\t\t\r\n\t\t// form rows\r\n\t\tthis.root.sortable({\r\n\t\t\t// axis: 'y',\r\n\t\t\t// containment: 'parent',\r\n\t\t\tconnectWith: '.dx-constructor-grid',\r\n\t\t\thandle: '.row-handle',\r\n\t\t\thelper: this.sortHelper,\r\n\t\t\tstart: this.onSortStart,\r\n\t\t\tstop: this.onSortStop\r\n\t\t});\r\n\t\t\r\n\t\t// form row columns\r\n\t\tthis.root.find('.columns').sortable(this.sortableOpts);\r\n\t\t\r\n\t\tthis.root.on('click', '.dx-cms-field-remove', function()\r\n\t\t{\r\n\t\t\tvar row = $(this).closest('.dd-list');\r\n\t\t\t$(this).tooltipster('hide');\r\n\t\t\tself.removeField($(this).closest('.dd-item').parent());\r\n\t\t\tself.updateRow(row);\r\n\t\t});\r\n\t\t\r\n\t\tthis.root.on('click', '.dx-cms-field-edit', function()\r\n\t\t{\r\n\t\t\tvar item = $(this).closest('.dd-item');\r\n\t\t\t\r\n\t\t\tif(item.hasClass('not-in-form'))\r\n\t\t\t{\r\n\t\t\t\tself.wizard.submit_fields(function()\r\n\t\t\t\t{\r\n\t\t\t\t\tself.showProperties(item);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tself.showProperties(item);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tthis.dialog.on('click', '.dx-view-btn-save', function()\r\n\t\t{\r\n\t\t\tself.saveProperties();\r\n\t\t});\r\n\t\t\r\n\t\t// handle row deletion\r\n\t\tthis.root.on('click', '.dx-constructor-row-remove', function()\r\n\t\t{\r\n\t\t\t$(this).tooltipster('hide');\r\n\t\t\tself.removeRow($(this).closest('.dx-constructor-row'))\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * When a field or a row is started to drag, highlight appropriate tabs where it can be dropped to.\r\n\t * @param event\r\n\t * @param ui\r\n\t */\r\n\tonSortStart: function(event, ui)\r\n\t{\r\n\t\t$('.dx-constructor-tab-buttons').addClass('highlight');\r\n\t},\r\n\t\r\n\t/**\r\n\t * Remove highlights on drag stop.\r\n\t * @param event\r\n\t * @param ui\r\n\t */\r\n\tonSortStop: function(event, ui)\r\n\t{\r\n\t\t$('.dx-constructor-tab-buttons').removeClass('highlight');\r\n\t},\r\n\t\r\n\t/**\r\n\t * Clones element being dragged. It is needed to drag elements between hidden tabs.\r\n\t * @param event\r\n\t * @param element\r\n\t * @returns {*}\r\n\t */\r\n\tsortHelper: function(event, element)\r\n\t{\r\n\t\tvar el = $(element.clone()).appendTo(document.body);\r\n\t\treturn el.get(0);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Add a new row to the grid.\r\n\t */\r\n\tcreateRow: function(type)\r\n\t{\r\n\t\tvar html = (type === 'columns') ? this.options.rowHtml : this.options.labelHtml;\r\n\t\t\r\n\t\tvar row = $(html).appendTo(this.root);\r\n\t\t\r\n\t\trow.find('.dx-constructor-row-remove').tooltipster({\r\n\t\t\ttheme: 'tooltipster-light',\r\n\t\t\tanimation: 'grow'\r\n\t\t});\r\n\t\t\r\n\t\tif(type === 'columns')\r\n\t\t{\r\n\t\t\trow.find('.columns').sortable(this.sortableOpts);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Handle deletion of a field.\r\n\t * @param field\r\n\t */\r\n\tremoveField: function(field)\r\n\t{\r\n\t\tif(field.hasClass('dx-field'))\r\n\t\t{\r\n\t\t\tfield.appendTo(this.fieldsContainer).attr('class', 'col-md-12');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfield.remove();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Handle removal of a row.\r\n\t * @param row\r\n\t */\r\n\tremoveRow: function(row)\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\trow.children('.columns').children().each(function()\r\n\t\t{\r\n\t\t\tself.removeField($(this));\r\n\t\t});\r\n\t\t\r\n\t\trow.remove();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Open modal dialog with properties of a field.\r\n\t * @param item\r\n\t */\r\n\tshowProperties: function(item)\r\n\t{\r\n\t\tvar fieldId = item.data('id');\r\n\t\tvar field = item.find('.dx-fld-title').text();\r\n\t\tvar hidden = item.data('hidden');\r\n\t\t\r\n\t\tthis.dialogId.val(fieldId);\r\n\t\tthis.dialogField.val(field);\r\n\t\t\r\n\t\tif((hidden && !this.dialogHidden.prop('checked')) || (!hidden && this.dialogHidden.prop('checked')))\r\n\t\t{\r\n\t\t\tthis.dialogHidden.click();\r\n\t\t}\r\n\t\t\r\n\t\tthis.dialog.modal('show');\r\n\t},\r\n\t\r\n\t/**\r\n\t * Update properties of a field via ajax call.\r\n\t */\r\n\tsaveProperties: function()\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tvar item = $('.dd-item[data-id=\"' + self.dialogId.val() + '\"]');\r\n\t\t\r\n\t\t//show_page_splash(1);\r\n\t\t\r\n\t\tvar request = {\r\n\t\t\t_method: 'put',\r\n\t\t\tfield_id: self.dialogId.val(),\r\n\t\t\ttitle_form: self.dialogField.val(),\r\n\t\t\tis_hidden: self.dialogHidden.prop('checked') ? '1' : '0'\r\n\t\t};\r\n\t\t\r\n\t\t$.ajax({\r\n\t\t\ttype: 'post',\r\n\t\t\turl: '/constructor/register/' + self.options.list_id + '/field_update',\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: request,\r\n\t\t\tsuccess: function(data)\r\n\t\t\t{\r\n\t\t\t\titem.find('.dx-fld-title').text(self.dialogField.val());\r\n\t\t\t\t\r\n\t\t\t\tif(self.dialogHidden.prop('checked'))\r\n\t\t\t\t{\r\n\t\t\t\t\titem.data('hidden', '1');\r\n\t\t\t\t\titem.addClass('dx-field-hidden');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\titem.data('hidden', '0');\r\n\t\t\t\t\titem.removeClass('dx-field-hidden');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//hide_page_splash(1);\r\n\t\t\t},\r\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\r\n\t\t\t{\r\n\t\t\t\tconsole.log(textStatus);\r\n\t\t\t\tconsole.log(jqXHR);\r\n\t\t\t\thide_page_splash(1);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tself.dialog.modal('hide');\r\n\t},\r\n\t\r\n\t/**\r\n\t * Update all rows.\r\n\t */\r\n\tupdateGrid: function()\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tthis.root.find('.row.columns').each(function()\r\n\t\t{\r\n\t\t\tself.updateRow($(this));\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * Calculate correct width of fields and apply grid classes to them.\r\n\t * @param row\r\n\t */\r\n\tupdateRow: function(row)\r\n\t{\r\n\t\tvar items = row.children().filter(function()\r\n\t\t{\r\n\t\t\treturn $(this).css('position') !== 'absolute' && $(this).css('display') !== 'none';\r\n\t\t});\r\n\t\t\r\n\t\tvar count = items.length;\r\n\t\t\r\n\t\tif(!count)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar col = Math.floor(12 / count);\r\n\t\t\r\n\t\titems.each(function()\r\n\t\t{\r\n\t\t\t$(this).removeClass(function(index, className)\r\n\t\t\t{\r\n\t\t\t\treturn (className.match(/(^|\\s)col-\\S+/g) || []).join(' ');\r\n\t\t\t});\r\n\t\t\t$(this).addClass('col-md-' + col);\r\n\t\t});\r\n\t}\r\n});","/**\r\n * Author:  Eugene Ostapenko <evo@olympsoft.com>\r\n * License: MIT\r\n * Created: 25.05.17, 17:48\r\n */\r\nModule.create('ConstructorWizard', {\r\n\tdefaults: {\r\n\t\tlist_id: 0,\r\n\t\tview_id: 1,\r\n\t\tform_id: 0,\r\n\t\tstep: 'names',\r\n\t\tsteps: ['names', 'columns', 'fields', 'rights', 'workflows'],\r\n\t\turl: '/constructor/register',\r\n\t\tlast_url: '/skats_'\r\n\t},\r\n\t\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstruct: function()\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tvar initName = 'init_' + this.options.step;\r\n\t\tvar submitName = 'submit_' + this.options.step;\r\n\t\t\r\n\t\t// init current step\r\n\t\tif($.isFunction(self[initName]))\r\n\t\t{\r\n\t\t\tself[initName]();\r\n\t\t}\r\n\t\t\r\n\t\tthis.root.on('click', '.mt-element-step .link', function()\r\n\t\t{\r\n\t\t\twindow.location = $(this).data('url');\r\n\t\t});\r\n\t\t\r\n\t\t// submit step\r\n\t\tthis.root.on('click', '#submit_step', function()\r\n\t\t{\r\n\t\t\tif($.isFunction(self[submitName]))\r\n\t\t\t{\r\n\t\t\t\tself[submitName]();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t// go one step back\r\n\t\tthis.root.on('click', '#prev_step', function()\r\n\t\t{\r\n\t\t\twindow.location = self.getPrevUrl();\r\n\t\t});\r\n\t\t\r\n\t\tthis.root.on('click', '#save_step', function()\r\n\t\t{\r\n\t\t\tif($.isFunction(self[submitName]))\r\n\t\t\t{\r\n\t\t\t\tself[submitName](function()\r\n\t\t\t\t{\r\n\t\t\t\t\ttoastr.success(Lang.get('constructor.save_success'));\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t// Advanced settings button on the top of the page\r\n\t\t$('.dx-adv-btn').click(function()\r\n\t\t{\r\n\t\t\tview_list_item('form', self.options.list_id, 3, 0, 0, \"\", \"\", {\r\n\t\t\t\tafter_close: function()\r\n\t\t\t\t{\r\n\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\t\r\n\tgetStepNumber: function()\r\n\t{\r\n\t\treturn this.options.steps.indexOf(this.options.step);\r\n\t},\r\n\t\r\n\tgetCurrentUrl: function()\r\n\t{\r\n\t\tif(!this.options.list_id)\r\n\t\t{\r\n\t\t\treturn this.options.url;\r\n\t\t}\r\n\t\t\r\n\t\tif(this.options.step == 'names')\r\n\t\t{\r\n\t\t\treturn this.options.url + '/' + this.options.list_id;\r\n\t\t}\r\n\t\t\r\n\t\treturn this.options.url + '/' + this.options.list_id + '/' + this.options.step;\r\n\t},\r\n\t\r\n\tgetNextUrl: function(list_id)\r\n\t{\r\n\t\tif(this.getStepNumber() + 1 == this.options.steps.length)\r\n\t\t{\r\n\t\t\treturn this.options.last_url + this.options.view_id;\r\n\t\t}\r\n\t\t\r\n\t\tlist_id = typeof list_id !== 'undefined' ? list_id : this.options.list_id;\r\n\t\t\r\n\t\treturn this.options.url + '/' + list_id + '/' + this.options.steps[this.getStepNumber() + 1];\r\n\t},\r\n\t\r\n\tgetPrevUrl: function()\r\n\t{\r\n\t\tif(this.getStepNumber() == 1)\r\n\t\t{\r\n\t\t\treturn this.options.url + '/' + this.options.list_id;\r\n\t\t}\r\n\t\t\r\n\t\treturn this.options.url + '/' + this.options.list_id + '/' + this.options.steps[this.getStepNumber() - 1];\r\n\t},\r\n\t\r\n\tinit_columns: function()\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\t$(\".dx-view-edit-form\").ViewEditor({\r\n\t\t\tview_container: $(\"#view_editor\"),\r\n\t\t\treloadBlockGrid: null,\r\n\t\t\troot_url: getBaseUrl(),\r\n\t\t\tload_tab_grid: null,\r\n\t\t\tonsave: function()\r\n\t\t\t{\r\n\t\t\t\twindow.location = self.getNextUrl();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tthis.viewEditor = $(\".dx-view-edit-form\").data('ViewEditor');\r\n\t\t\r\n\t\t$('.dx-new-field').click(function()\r\n\t\t{\r\n\t\t\tnew_list_item(7, 17, self.options.list_id, \"\", \"\", {\r\n\t\t\t\tafter_close: function(frm)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar item_id = $(frm).find('input[name=\"item_id\"]').val();\r\n\t\t\t\t\tvar item_name = $(frm).find('input[name=\"title_list\"]').val();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(item_id == 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar item = $(\r\n\t\t\t\t\t\t'<li class=\"dd-item\" data-id=\"\" data-list-id=\"\" data-is-hidden=\"0\" data-operation-id=\"0\" data-criteria=\"\" data-field-type=\"varchar\" data-rel-list-id=\"\" data-rel-field-id=\"\" data-aggregation-id=\"0\">' +\r\n\t\t\t\t\t\t'<div class=\"dd-handle dd3-handle\"> </div>' +\r\n\t\t\t\t\t\t'<div class=\"dd3-content\">' +\r\n\t\t\t\t\t\t'<div class=\"row\">' +\r\n\t\t\t\t\t\t'<div class=\"col-md-10\">' +\r\n\t\t\t\t\t\t'<b class=\"dx-fld-title\"></b>' +\r\n\t\t\t\t\t\t'<i class=\"fa fa-filter dx-icon-filter\"></i>' +\r\n\t\t\t\t\t\t'<i class=\"fa fa-eye-slash dx-icon-hidden\"></i>' +\r\n\t\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t\t'<div class=\"col-md-2\">' +\r\n\t\t\t\t\t\t'<a href=\"javascript:;\" title=\"' + Lang.get('grid.btn_remove_fld') + '\" class=\"pull-right dx-cms-field-remove\"><i class=\"fa fa-trash-o\"></i></a>' +\r\n\t\t\t\t\t\t'<a href=\"javascript:;\" title=\"' + Lang.get('grid.btn_add_fld') + '\" class=\"pull-right dx-cms-field-add\"><i class=\"fa fa-plus-square-o\"></i></a>' +\r\n\t\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t\t'</li>'\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\t\t\t\t\titem.attr('data-id', item_id);\r\n\t\t\t\t\titem.attr('data-list-id', self.options.list_id);\r\n\t\t\t\t\titem.find('.dx-fld-title').text(item_name);\r\n\t\t\t\t\t\r\n\t\t\t\t\titem.appendTo('.dd.dx-available .dd-list');\r\n\t\t\t\t\t\r\n\t\t\t\t\titem.find('[title]').tooltipster({\r\n\t\t\t\t\t\ttheme: 'tooltipster-light',\r\n\t\t\t\t\t\tanimation: 'grow'\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tself.viewEditor.setFldEventHandlers(self.viewEditor.frm_el, item, self.viewEditor.options.view_container);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\t\r\n\tinit_fields: function()\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tthis.root.find('.dx-constructor-tab-buttons').ConstructorTabs({\r\n\t\t\tform_id: this.options.form_id,\r\n\t\t\tlist_id: this.options.list_id\r\n\t\t});\r\n\t\t\r\n\t\tthis.root.find('.dx-constructor-grid').ConstructorGrid({\r\n\t\t\tlist_id: this.options.list_id\r\n\t\t});\r\n\t\t\r\n\t\t// handle row creation\r\n\t\tthis.root.find('.dx-add-row-btn').click(function()\r\n\t\t{\r\n\t\t\tvar grid;\r\n\t\t\t\r\n\t\t\tif($(this).parents('.dx-constructor-tabs').length)\r\n\t\t\t{\r\n\t\t\t\tvar tab = self.root.find('.dx-constructor-tab:visible');\r\n\t\t\t\t\r\n\t\t\t\tgrid = tab.find('.dx-constructor-grid').data('ConstructorGrid');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tgrid = self.root.find('.dx-constructor-form .dx-constructor-grid').data('ConstructorGrid');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tgrid.createRow($(this).data('type'));\r\n\t\t});\r\n\t\t\r\n\t\t$('.dx-preview-btn').click(function()\r\n\t\t{\r\n\t\t\tself.submit_fields(function()\r\n\t\t\t{\r\n\t\t\t\tnew_list_item(self.options.list_id, 0, 0, \"\", \"\");\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\t\r\n\tinit_rights: function()\r\n\t{\r\n\t\tvar self = this;\r\n\t\tvar rights = ['is_new_rights', 'is_edit_rights', 'is_delete_rights'];\r\n\t\tvar tbody = $('.dx-constructor-roles-table tbody');\r\n\t\t\r\n\t\tthis.root.on('click', '.dx-constructor-add-role', function()\r\n\t\t{\r\n\t\t\tnew_list_item(23, 105, self.options.list_id, \"\", \"\", {\r\n\t\t\t\tafter_close: function(frm)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar role_id = $(frm).find('input[name=\"id\"]').val();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif((typeof role_id == 'undefined') || role_id == 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar role_name = $(frm).find('input[dx_fld_name=\"role_id\"]').val();\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar tr = $(\r\n\t\t\t\t\t\t'<tr>' +\r\n\t\t\t\t\t\t'<td width=\"30%\">' +\r\n\t\t\t\t\t\t'<i class=\"fa fa-key\"></i> ' +\r\n\t\t\t\t\t\t'<a href=\"javascript:;\" class=\"dx-constructor-edit-role\" data-role_id=\"' + role_id + '\">' + role_name + '</a>' +\r\n\t\t\t\t\t\t'</td>' +\r\n\t\t\t\t\t\t'<td></td>' +\r\n\t\t\t\t\t\t'</tr>'\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar td = tr.children('td').last();\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor(var i = 0; i < rights.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar right = rights[i];\r\n\t\t\t\t\t\tvar input = $(frm).find('input[name=\"' + right + '\"]');\r\n\t\t\t\t\t\tif(input.length && input.prop('checked'))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttd.append('<label class=\"badge badge-default\">' + Lang.get('constructor.' + right) + '</label> ');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\ttr.appendTo(tbody);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\tthis.root.on('click', '.dx-constructor-edit-role', function()\r\n\t\t{\r\n\t\t\tvar a = $(this);\r\n\t\t\tvar td = $(this).closest('td').next();\r\n\t\t\tvar role_id = $(this).data('role_id');\r\n\t\t\t\r\n\t\t\tview_list_item('form', role_id, 23, 105, self.options.list_id, \"\", \"\", {\r\n\t\t\t\tafter_close: function(frm)\r\n\t\t\t\t{\r\n\t\t\t\t\ta.text($(frm).find('input[dx_fld_name=\"role_id\"]').val());\r\n\t\t\t\t\t\r\n\t\t\t\t\ttd.empty();\r\n\t\t\t\t\tfor(var i = 0; i < rights.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar right = rights[i];\r\n\t\t\t\t\t\tvar input = $(frm).find('input[name=\"' + right + '\"]');\r\n\t\t\t\t\t\tif(input.length && input.prop('checked'))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttd.append('<label class=\"badge badge-default\">' + Lang.get('constructor.' + right) + '</label> ');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\t\r\n\tsubmit_names: function()\r\n\t{\r\n\t\tvar self = this;\r\n\t\tvar listName = this.root.find('#list_name');\r\n\t\tvar itemName = this.root.find('#item_name');\r\n\t\tvar menuParentID = this.root.find('input[name=parent_id]');\r\n\t\t\r\n\t\tif(listName.length && !listName.val())\r\n\t\t{\r\n\t\t\ttoastr.error(Lang.get('constructor.enter_name'));\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tif(itemName.length && !itemName.val())\r\n\t\t{\r\n\t\t\ttoastr.error(Lang.get('constructor.enter_item_name'));\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tshow_page_splash(1);\r\n\t\t\r\n\t\tvar request = {\r\n\t\t\tlist_name: listName.val(),\r\n\t\t\titem_name: itemName.val(),\r\n\t\t\tmenu_parent_id: menuParentID.val()\r\n\t\t};\r\n\t\t\r\n\t\tif(this.options.list_id)\r\n\t\t{\r\n\t\t\trequest._method = 'put';\r\n\t\t}\r\n\t\t\r\n\t\t$.ajax({\r\n\t\t\ttype: 'post',\r\n\t\t\turl: this.getCurrentUrl(),\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: request,\r\n\t\t\tsuccess: function(data)\r\n\t\t\t{\r\n\t\t\t\thide_page_splash(1);\r\n\t\t\t\t\r\n\t\t\t\twindow.location = self.getNextUrl(data.list_id);\r\n\t\t\t},\r\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\r\n\t\t\t{\r\n\t\t\t\tconsole.log(textStatus);\r\n\t\t\t\tconsole.log(jqXHR);\r\n\t\t\t\thide_page_splash(1);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\tsubmit_columns: function()\r\n\t{\r\n\t\t$(\".dx-view-edit-form\").data('ViewEditor').save();\r\n\t},\r\n\t\r\n\tsubmit_fields: function(onSuccess)\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tshow_page_splash(1);\r\n\t\t\r\n\t\tvar request = {\r\n\t\t\t_method: 'put',\r\n\t\t\ttabs: [],\r\n\t\t\titems: []\r\n\t\t};\r\n\t\t\r\n\t\tthis.root.find('.dx-constructor-tab-buttons .dd-item').each(function()\r\n\t\t{\r\n\t\t\trequest.tabs.push($(this).data('id'));\r\n\t\t});\r\n\t\t\r\n\t\tthis.root.find('.dx-constructor-form, .dx-constructor-tab.custom-data').each(function()\r\n\t\t{\r\n\t\t\tvar tab = [];\r\n\t\t\t\r\n\t\t\t$(this).find('.dx-constructor-grid .dx-constructor-row').each(function()\r\n\t\t\t{\r\n\t\t\t\tvar row = [];\r\n\t\t\t\tvar label;\r\n\t\t\t\t\r\n\t\t\t\tif($(this).find('.columns').length)\r\n\t\t\t\t{\r\n\t\t\t\t\t$(this).find('.dd-item').each(function()\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trow.push($(this).data('id'));\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\telse if((label = $(this).find('.dx-constructor-label')) && label.length && label.val().length)\r\n\t\t\t\t{\r\n\t\t\t\t\trow.push({\r\n\t\t\t\t\t\tlabel: label.val()\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(row.length)\r\n\t\t\t\t{\r\n\t\t\t\t\ttab.push(row);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif(tab.length)\r\n\t\t\t{\r\n\t\t\t\trequest.items[$(this).data('tabId')] = tab;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t$.ajax({\r\n\t\t\ttype: 'post',\r\n\t\t\turl: this.getCurrentUrl(),\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: request,\r\n\t\t\tsuccess: function(data)\r\n\t\t\t{\r\n\t\t\t\t$('.dx-constructor-grid .dd-item.not-in-form').removeClass('not-in-form');\r\n\t\t\t\t$('.dx-fields-container .dd-item').addClass('not-in-form');\r\n\t\t\t\t\r\n\t\t\t\tif(typeof onSuccess === 'function')\r\n\t\t\t\t{\r\n\t\t\t\t\tonSuccess();\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\twindow.location = self.getNextUrl();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\thide_page_splash(1);\r\n\t\t\t},\r\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\r\n\t\t\t{\r\n\t\t\t\tconsole.log(textStatus);\r\n\t\t\t\tconsole.log(jqXHR);\r\n\t\t\t\thide_page_splash(1);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\tsubmit_rights: function()\r\n\t{\r\n\t\twindow.location = this.getNextUrl();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Saves workflow data\r\n\t */\r\n\tsubmit_workflows: function(onSuccess)\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tif($('.dx-cms-workflow-form-input-title').val().trim().length > 0)\r\n\t\t{\r\n\t\t\tvar workflow = $('.dx-cms-workflow-form')[0].workflow;\r\n\t\t\t\r\n\t\t\tworkflow.saveCallback = function()\r\n\t\t\t{\r\n\t\t\t\tif($.isFunction(onSuccess))\r\n\t\t\t\t{\r\n\t\t\t\t\tonSuccess();\r\n\t\t\t\t}\r\n\t\t\t\telse if(workflow.isGraphInit)\r\n\t\t\t\t{\r\n\t\t\t\t\twindow.location = self.getNextUrl();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tworkflow.save({self: workflow, initGraph: true});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\twindow.location = self.getNextUrl();\r\n\t\t}\r\n\t}\r\n});\r\n"]}