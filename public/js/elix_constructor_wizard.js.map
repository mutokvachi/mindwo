{"version":3,"sources":["constructor_wizard.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"elix_constructor_wizard.js","sourcesContent":["/**\n * Author:  Eugene Ostapenko <evo@olympsoft.com>\n * License: MIT\n * Created: 25.05.17, 17:48\n */\n\n(function($)\n{\n\t$.fn.ConstructorWizard = function(opts)\n\t{\n\t\tvar options = $.extend({}, $.fn.ConstructorWizard.defaults, opts);\n\t\t\n\t\treturn this.each(function()\n\t\t{\n\t\t\tnew $.ConstructorWizard(this, options);\n\t\t});\n\t};\n\t\n\t$.fn.ConstructorWizard.defaults = {\n\t\tlist_id: 0,\n\t\tview_id: 1,\n\t\tstep: 'names',\n\t\tsteps: ['names', 'columns', 'fields', 'rights', 'menu'],\n\t\turl: '/constructor/register',\n\t\tlast_url: '/skats_'\n\t};\n\t\n\t$.ConstructorWizard = function(root, opts)\n\t{\n\t\t$.data(root, 'ConstructorWizard', this);\n\t\t\n\t\tvar self = this;\n\t\tthis.root = $(root);\n\t\tthis.options = opts;\n\t\t\n\t\tvar initName = 'init_' + this.options.step;\n\t\tvar submitName = 'submit_' + this.options.step;\n\t\t\n\t\t// init current step\n\t\tif($.isFunction(this[initName]))\n\t\t{\n\t\t\tthis[initName]();\n\t\t}\n\t\t\n\t\t// submit step\n\t\tthis.root.on('click', '#submit_step', function()\n\t\t{\n\t\t\tif($.isFunction(self[submitName]))\n\t\t\t{\n\t\t\t\tself[submitName]();\n\t\t\t}\n\t\t});\n\t\t\n\t\t// go one step back\n\t\tthis.root.on('click', '#prev_step', function()\n\t\t{\n\t\t\twindow.location = self.getPrevUrl();\n\t\t});\n\t};\n\t\n\t$.extend($.ConstructorWizard.prototype, {\n\t\tgetStepNumber: function()\n\t\t{\n\t\t\treturn this.options.steps.indexOf(this.options.step);\n\t\t},\n\t\t\n\t\tgetCurrentUrl: function()\n\t\t{\n\t\t\tif(!this.options.list_id)\n\t\t\t{\n\t\t\t\treturn this.options.url;\n\t\t\t}\n\t\t\t\n\t\t\tif(this.options.step == 'names')\n\t\t\t{\n\t\t\t\treturn this.options.url + '/' + this.options.list_id;\n\t\t\t}\n\t\t\t\n\t\t\treturn this.options.url + '/' + this.options.list_id + '/' + this.options.step;\n\t\t},\n\t\t\n\t\tgetNextUrl: function(list_id)\n\t\t{\n\t\t\tif(this.getStepNumber() + 1 == this.options.steps.length)\n\t\t\t{\n\t\t\t\treturn this.options.last_url + this.options.view_id;\n\t\t\t}\n\t\t\t\n\t\t\tlist_id = typeof list_id !== 'undefined' ? list_id : this.options.list_id;\n\t\t\t\n\t\t\treturn this.options.url + '/' + list_id + '/' + this.options.steps[this.getStepNumber() + 1];\n\t\t},\n\t\t\n\t\tgetPrevUrl: function()\n\t\t{\n\t\t\tif(this.getStepNumber() == 1)\n\t\t\t{\n\t\t\t\treturn this.options.url + '/' + this.options.list_id;\n\t\t\t}\n\t\t\t\n\t\t\treturn this.options.url + '/' + this.options.list_id + '/' + this.options.steps[this.getStepNumber() - 1];\n\t\t},\n\t\t\n\t\tinit_fields: function()\n\t\t{\n\t\t\tthis.root.find('.dd-item').draggable({\n\t\t\t\thandle: '.dd-handle',\n\t\t\t\trevert: 'invalid',\n\t\t\t\thelper: 'clone'\n\t\t\t});\n\t\t\t\n\t\t\tthis.root.find('.droppable-grid td').droppable({\n\t\t\t\taccept: '.dd-item',\n\t\t\t\tdrop: function(event, ui)\n\t\t\t\t{\n\t\t\t\t\t$(this).append(ui.draggable);\n\t\t\t\t\tui.draggable.addClass('dropped');\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tthis.root.on('click', '.dx-cms-field-remove', function()\n\t\t\t{\n\t\t\t\t$(this)\n\t\t\t\t\t.closest('.dropped')\n\t\t\t\t\t.removeClass('dropped')\n\t\t\t\t\t.appendTo('.dd-list');\n\t\t\t});\n\t\t},\n\t\t\n\t\tsubmit_names: function()\n\t\t{\n\t\t\tvar self = this;\n\t\t\tvar listName = this.root.find('#list_name');\n\t\t\tvar itemName = this.root.find('#item_name');\n\t\t\t\n\t\t\tif(listName.length && !listName.val())\n\t\t\t{\n\t\t\t\ttoastr.error('Please enter register name.');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\tif(itemName.length && !itemName.val())\n\t\t\t{\n\t\t\t\ttoastr.error('Please enter item name.');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\tshow_page_splash(1);\n\t\t\t\n\t\t\tvar request = {\n\t\t\t\tlist_name: listName.val(),\n\t\t\t\titem_name: itemName.val()\n\t\t\t};\n\t\t\t\n\t\t\tif(this.options.list_id)\n\t\t\t{\n\t\t\t\trequest._method = 'put';\n\t\t\t}\n\t\t\t\n\t\t\t$.ajax({\n\t\t\t\ttype: 'post',\n\t\t\t\turl: this.getCurrentUrl(),\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: request,\n\t\t\t\tsuccess: function(data)\n\t\t\t\t{\n\t\t\t\t\thide_page_splash(1);\n\t\t\t\t\twindow.location = self.getNextUrl(data.list_id);\n\t\t\t\t},\n\t\t\t\terror: function(jqXHR, textStatus, errorThrown)\n\t\t\t\t{\n\t\t\t\t\tconsole.log(textStatus);\n\t\t\t\t\tconsole.log(jqXHR);\n\t\t\t\t\thide_page_splash(1);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\n\t\tsubmit_columns: function()\n\t\t{\n\t\t\twindow.location = this.getNextUrl();\n\t\t},\n\t\t\n\t\tsubmit_fields: function()\n\t\t{\n\t\t\tvar self = this;\n\t\t\t\n\t\t\tshow_page_splash(1);\n\t\t\t\n\t\t\tvar request = {\n\t\t\t\t_method: 'put',\n\t\t\t\titems: []\n\t\t\t};\n\t\t\t\n\t\t\tthis.root.find('.droppable-grid td').each(function()\n\t\t\t{\n\t\t\t\tvar dd = $(this).children('.dd-item');\n\t\t\t\t\n\t\t\t\tif(dd.length)\n\t\t\t\t{\n\t\t\t\t\tvar item = {\n\t\t\t\t\t\tid: dd.data('id'),\n\t\t\t\t\t\trow: $(this).parent().prevAll().length + 1,\n\t\t\t\t\t\tcol: $(this).prevAll().length + 1\n\t\t\t\t\t};\n\t\t\t\t\trequest.items.push(item);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t$.ajax({\n\t\t\t\ttype: 'post',\n\t\t\t\turl: this.getCurrentUrl(),\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: request,\n\t\t\t\tsuccess: function(data)\n\t\t\t\t{\n\t\t\t\t\thide_page_splash(1);\n\t\t\t\t\twindow.location = self.getNextUrl();\n\t\t\t\t},\n\t\t\t\terror: function(jqXHR, textStatus, errorThrown)\n\t\t\t\t{\n\t\t\t\t\tconsole.log(textStatus);\n\t\t\t\t\tconsole.log(jqXHR);\n\t\t\t\t\thide_page_splash(1);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\n\t\tsubmit_rights: function()\n\t\t{\n\t\t\twindow.location = this.getNextUrl();\n\t\t},\n\t\t\n\t\tsubmit_menu: function()\n\t\t{\n\t\t\twindow.location = this.getNextUrl();\n\t\t}\n\t});\n})(jQuery);\n"]}