{"version":3,"sources":["search_top.js","userlinks.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5XA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"elix_userlinks.js","sourcesContent":["/**\n * Lapas augšējās joslas meklēšanas lauka funkcionalitāte\n * \n * @type _L4.Anonym$0|Function\n */\nvar SearchTop = function()\n{\n    /**\n     * Aktuālais meklēšanas tips\n     * \n     * @type String\n     */\n    var current_type = \"\";\n\n    /**\n     * Paziņojuma teksts, ja nekas nav atrasts pēc norādītā kritērija\n     * \n     * @type String\n     */\n    var txt_nothing_found = \"Nav atrasts neviens atbilstošs ieraksts.\";\n    \n    /**\n     * Noklusētais paziņojuma teksts, kamēr vēl nav veikta darbinieku meklēšana\n     * \n     * @type String\n     */\n    var txt_default_info = \"Lūdzu, ievadiet vismaz trīs burtus, un tiks veikta dinamiskā darbinieku meklēšana.\";\n    \n    /**\n     * Employee label title\n     * \n     * @type String\n     */\n    var txt_employee = \"Darbinieki\";\n    \n    /**\n     * Searching in progress label\n     * \n     * @type String\n     */\n    var txt_searching = \"Meklē....\";\n    \n    /**\n     * Norāda, vai ir parādīts izslīdošais darbinieku meklēšanas rezultātu bloks\n     * \n     * @type Number\n     */\n    var is_sidebar_shown = 0;\n    \n    var is_search_on_top = 1;\n\n    var statusDisplay = $(\"#quick-search-status\");\n    \n    /**\n     * Veic AJAX pieprasījumu ar darbinieku meklēšanu\n     * \n     * @returns {undefined}\n     */\n    var doAjaxSearch = function() {\n        \n        var criteria = $(\"#search_criteria\").val().trim();\n        \n        if (criteria == \"\")\n        {\n            $(\".dx-employees-quick-results\").html('');\n            statusDisplay.html(txt_default_info);\n            return;\n        }\n        \n        if (criteria.length < 3) {\n            $(\".dx-employees-quick-results\").html('');\n            statusDisplay.html(txt_default_info);\n            return;\n        }\n        \n        /*\n        var formData = new FormData();\n        formData.append(\"criteria\", criteria);\n        */\n        var formData = \"criteria=\" + criteria;\n        var ajax_url = 'ajax/employees';\n        \n        $(\".dx-employees-quick-results\").html('');\n        statusDisplay.html(txt_searching);\n\n        var request = new FormAjaxRequestIE9 (ajax_url, \"\", \"\", formData);            \n        request.progress_info = \"\";\n\n        request.callback = function(data) {\n\n            if (data['html'].indexOf('employee-list') !== -1) {\n                $(\".dx-employees-quick-results\").html(data['html']);\n\n                EmployeesLinks.init($(\"#dx-top-search-div\").find(\".employee-list\"), clearCriteria);\n                statusDisplay.html('');\n            }\n            else {\n                // nothing found\n                statusDisplay.html(txt_nothing_found);\n            }\n        };\n\n        // izpildam AJAX pieprasījumu\n        request.doRequest();\n    };    \n    \n    /**\n     * Notīra darbinieku meklēšanas frāzes lauku\n     * \n     * @returns {undefined}\n     */\n    var clearCriteria = function() {\n        $(\"#search_criteria\").val('');\n    }\n    \n    /**\n     * Nodrošina meklēšanas tipa izvēles apstrādi - uzstāda meklēšanas tipa tekstu un ieliek kursora fokusu meklēšanas laukā\n     * \n     * @returns {undefined}\n     */\n    var handleTypeChoose = function() {\n        $(\"#top_search a\").each(function() {\n            $(this).click(function(e) {\n                $(\"#search_title\").html($(this).text());\n                $(\"#searchType\").val($(this).text());\n                current_type = $(this).text();\n                $(\"#search_criteria\").focus();                \n            });\n        });\n    };\n\t\n\tvar handleTypeChooseCSSOnly = function() {\n\t\t$(\"#top_search a\").each(function() {\n\t\t\t$(this).click(function(e) {\n\t\t\t\t$(\"#search_title\").html($('span', this).text());\n\t\t\t\t$(\"#search_dropd\").find(\"span\").children().replaceWith($('i', this).clone());\n\t\t\t\t$(\"#searchType\").val($('span', this).text());\n\t\t\t\tcurrent_type = $('span', this).text();\n\t\t\t\t$(\"#search_criteria\").focus();\n\t\t\t});\n\t\t});\n\t};\n\n    /**\n     * Nodrošina meklēšanas izpildi uz pogas nospiešanu\n     * \n     * @returns {undefined}\n     */\n    var handleBtnSearch = function() {\n        $(\"#search_btn\").click(function() {\n            show_page_splash();\n        });\n    };\n    \n    var hideSideBar = function() {\n        $('body').toggleClass('page-quick-sidebar-open');\n        is_sidebar_shown = 0;\n        $(\".dx-employees-quick-results\").html('');  \n        statusDisplay.html(txt_default_info);\n\n    };\n    \n    /**\n     * Parāda izslīdošo darbinieku meklēšanas rezultātu bloku, ja ir fokuss uz meklēšanas lauku.\n     * Bloku rāda tikai tad, ja meklēšanas tips ir Darbinieki\n     * \n     * @returns {undefined}\n     */\n    var handleQuickSidebarToggler = function() {\n        // quick sidebar toggler\n        $('#search_criteria').on('keyup', function(e) {\n            if (current_type == txt_employee)\n            {\n                if (is_sidebar_shown == 0 && is_search_on_top == 1)\n                {                    \n                    $('body').toggleClass('page-quick-sidebar-open');\n                    is_sidebar_shown = 1;\n                    \n                    if ($(\"#search_criteria\").val().trim() != \"\")\n                    {\n                        doAjaxSearch();\n                    }\n                }\n            }\n            else\n            {\n                if (is_sidebar_shown == 1)\n                {\n                    hideSideBar();\n                }\n            }\n        });\n    };\n\n    /**\n     * Paslēp darbinieku meklēšanas rezultātu bloku, ja nospiests krustiņš\n     * \n     * @returns {undefined}\n     */\n    var handleSidebarHide = function() {\n        $(\"a.close-quick-sidebar\").click(function() {\n            if (is_sidebar_shown == 1)\n            {\n                $('body').toggleClass('page-quick-sidebar-open');\n                is_sidebar_shown = 0;\n            }\n        });\n    };\n    \n    /**\n     * Nodrošina darbinieku ātro meklēšanu - AJAX pieprasījuma izpilde, ja ievada kādu simbolu meklēšanas laukā\n     * \n     * @returns {undefined}\n     */\n    var handleQuickSearch = function() {\n        $(\"#search_criteria\").keyup(function() {\n            if (is_sidebar_shown)\n            {\n                doAjaxSearch();\n            }\n        });        \n    };\n    \n    /**\n     * Nodrošina darbinieku ātro meklēšanu - AJAX pieprasījuma izpilde, ja meklēšanas laukā iekopē kādu tekstu\n     * \n     * @returns {undefined}\n     */\n    var handleCopyPasteSearch = function() {\n        $('#search_criteria').bind('paste', function () {            \n            if (current_type == txt_employee) {\n                setTimeout(function () {\n                    doAjaxSearch();\n                }, 100);\n            }\n        });\n    };\n    \n    /**\n     * Uzstāda izslīdošā darbinieku meklēšanas rezultāta bloka platumu atbilstoši loga platumam\n     * \n     * @returns {undefined}\n     */\n    var initSidebarStyle = function() {                \n        \n        var width = 760; //$( document ).width() - $(\"#top_search\").offset().left;\n        \n        if ($(\"#employee_quick_css\").length == 0)\n        {\n            $(\"head\").append('<style type=\"text/css\" id=\"employee_quick_css\"></style>');\n        }\n        var newStyleElement = $(\"#employee_quick_css\");\n        newStyleElement.html('.page-quick-sidebar-wrapper{width:' + width + 'px; right: -' + width + 'px;}');\n        \n        if ( $.isFunction($.fn.slimScroll) ) {\n            if ($(\".dx-employees-quick .slimScrollDiv\").length)\n            {\n                $(\".dx-employees-quick-results\").slimScroll({destroy: true});\n            }\n\n            $('.dx-employees-quick-results').slimScroll({\n                height: $(\".dx-employees-quick\").height() + 'px',\n                position: 'left',\n                color: '#f1f4f7'\n            });\n        }\n    };\n    \n    var placeSearchBox = function() {\n        if ($( document ).width() > 990) {\n            // show on top\n            if (is_search_on_top){\n                return;\n            }\n            \n            var htm = $(\"#dx-search-box-in-page\").html();\n            $(\"#dx-search-box-in-page\").html(\"\");\n            \n            $(\"#dx-search-box-top-li\").html(htm);\n            is_search_on_top = 1;\n            initHandlers();\n        }\n        else\n        {            \n            // show in page content\n            if (!is_search_on_top){\n                return;\n            }\n            \n            var htm = $(\"#dx-top-search-form\").parent().html();\n            $(\"#dx-top-search-form\").remove();\n            \n            $(\"#dx-search-box-in-page\").html(htm);\n            is_search_on_top = 0;\n            initHandlers();\n            \n            if (is_sidebar_shown == 1)\n            {\n                hideSideBar();\n            }\n        }\n        \n    };\n    \n    /**\n     * Initialize button handlers and styles\n     * \n     * @returns {undefined}\n     */\n    var initHandlers = function() {\n        if(dx_is_cssonly)\n        {\n\t\t\thandleTypeChooseCSSOnly();\n        }\n        else\n\t\t{\n\t\t\thandleTypeChoose();\n\t\t}\n        handleBtnSearch();\n        \n        initSidebarStyle();\n        handleQuickSidebarToggler();\n        handleSidebarHide();\n        handleQuickSearch();\n        handleCopyPasteSearch();\n    };\n    \n    /**\n     * Initialize translations for messages and labels\n     * \n     * @returns {undefined}\n     */\n    var initTranslations = function() {\n        var search_obj = $(\"#dx-top-search-div\");\n        txt_nothing_found = search_obj.attr('trans_nothing_found');\n        txt_default_info = search_obj.attr('trans_default_info');\n        txt_employee = search_obj.attr('trans_employees');\n        txt_searching = search_obj.attr('trans_searching');\n    };\n    \n    /**\n     * Inicializē slīdrādes bloku\n     * \n     * @returns {undefined}\n     */\n    var initSearch = function()\n    {\n        initTranslations();\n        \n        initHandlers();\n        \n        var search_obj = $(\"#dx-top-search-div\");\n        \n        $(\"#searchType\").val(search_obj.attr('trans_default'));\n        current_type = search_obj.attr('trans_default');\n\n        if(!dx_is_cssonly)\n\t\t{\n\t\t\tplaceSearchBox();\n\t\t}\n        \n        // Pievienojam izslīdošā darbinieku rezultātu bloka pārzīmēšanas izsaukumu uz lapas/loga izmēra izmaiņām\n        PageMain.addResizeCallback(initSidebarStyle);\n        \n\t\tif(!dx_is_cssonly)\n\t\t{\n\t\t\tPageMain.addResizeCallback(placeSearchBox);\n\t\t}\n    };\n\n    return {\n        init: function() {\n            initSearch();\n        }\n    };\n}();\n\n$(document).ready(function() {\n    $('[autofocus]:not(:focus)').eq(0).focus();\n    SearchTop.init();\n});","/**\n * SVS lietotāja profila funkcionalitāte - paroles maiņa\n * \n * @type _L4.Anonym$0|Function\n */\nvar UserLinks = function()\n{\n    /**\n     * Paroles nomaiņas formas elements\n     * \n     * @type Object\n     */\n    var pass_form = null;\n    \n    /**\n     * Izpilda paroles maiņas AJAX pieprasījumu - saglabā jauno paroli\n     * \n     * @returns {undefined}\n     */\n    var changePassw = function() {\n        \n        var formData = new FormData();\n        formData.append(\"pass_old\", pass_form.find(\"input[name='pass_old']\").val());\n        formData.append(\"pass_new1\", pass_form.find(\"input[name='pass_new1']\").val());\n        formData.append(\"pass_new2\", pass_form.find(\"input[name='pass_new2']\").val());\n\n        var ajax_url = '/ajax/change_password';\n\n        var request = new FormAjaxRequest (ajax_url, \"\", \"\", formData);            \n        request.progress_info = DX_CORE.trans_data_processing;                       \n\n        request.callback = function(data) {\n\n            notify_info(DX_CORE.trans_data_saved);          \n\n        };\n\n        // izpildam AJAX pieprasījumu\n        request.doRequest();\n    };    \n    \n    /**\n     * Uzstāda formas laukiem validatoru\n     * \n     * @returns {undefined}\n     */\n    var setValidator = function() {\n        pass_form.validator({            \n            errors: {\n                auto: 'Nav norādīta vērtība!'\n            },\n            feedback: {\n                success: 'glyphicon-ok',\n                error: 'glyphicon-alert'\n            }\n        }); \n    };\n    \n    /**\n     * Nodrošina paroles maiņas formas atvēršanu\n     * \n     * @returns {undefined}\n     */\n    var handleLinkPassword = function() {\n        $(\"a.dx-user-change-passw-link\").click(function(){\n            get_popup_item_by_id(0, 'ajax/form_password', DX_CORE.trans_passw_form_title);\n        });\n    };\n    \n    /**\n     * Nodrošina paroles maiņas saglabāšanas izsaukumu - pogas \"Mainīt paroli\" nospiešana\n     * \n     * @returns {undefined}\n     */\n    var handleBtnChange = function() {\n        pass_form.find(\".dx-user-change-passw-btn\").click(function() {\n            changePassw();\n        });\n    };\n    \n    /**\n     * Uzstāda laukiem validatoru. Ja validatora komponente vēl netika iekļauta, tad dinamiski to iekļauj\n     * \n     * @returns {undefined}\n     */\n    var handleValidator = function() {        \n        if ( !$.isFunction($.fn.validator) ) {\n            $.getScript( getBaseUrl() + \"plugins/validator/validator.js\", setValidator);\n        }\n        else{\n            setValidator();\n        }\n    };\n    \n    /**\n     * Inicializē lietotāja profila iespējas\n     * \n     * @returns {undefined}\n     */\n    var initProfile = function()\n    {\n        handleLinkPassword();        \n    };\n    \n    /**\n     * Inicializē paroles nomaiņas formu - tā tiek ielādēta ar AJAX\n     * \n     * @returns {undefined}\n     */\n    var initPasswForm = function() {\n        \n        if ($(\".dx-user-change-passw-form[dx_block_init='0']\").length == 0) {\n            return; // jau ir inicializēts\n        }\n        \n        pass_form = $(\".dx-user-change-passw-form\");\n        \n        handleBtnChange();\n        handleValidator();\n        \n        pass_form.attr(\"dx_block_init\", 1);\n        \n        setTimeout(function() {\n            pass_form.find(\"input[name='pass_old']\").focus();\n        }, 500);\n        \n    };\n\n    return {\n        init: function() {\n            initProfile();\n        },\n        initPasswForm: function() {\n            initPasswForm();\n        }\n    };\n}();\n\n$(document).ready(function() {\n    UserLinks.init();\n});\n\n$(document).ajaxComplete(function(event, xhr, settings) {\n    UserLinks.initPasswForm();\n});"]}