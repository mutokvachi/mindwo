!function(t){t.fn.MenuBuilder=function(n){var i=t.extend({},t.fn.MenuBuilder.defaults,n);return this.each(function(){new t.MenuBuilder(this,i)})},t.fn.MenuBuilder.defaults={root_url:getBaseUrl(),builder_url:"constructor/menu/",menu_list_id:5},t.MenuBuilder=function(n,i){t.data(n,"MenuBuilder",this);var o=this;this.options=i,this.root=t(n),this.nodes=null,this.root_url=getBaseUrl(),this.site_id=o.root.find(".dx-sites-cbo").val(),this.itm_to_edit=null;var e=function(n){show_page_splash();var i={site_id:o.site_id,items:o.nodes,_method:"put"},e=o.options.root_url+o.options.builder_url+o.site_id;t.ajax({type:"post",url:e,dataType:"json",data:i,success:function(i){o.nodes=null,t(".dx-stick-footer").removeClass("dx-page-in-edit-mode"),n?n.call(this):(show_page_splash(),notify_info(Lang.get("constructor.menu.msg_saved")),setTimeout(function(){window.location.reload(!0)},1e3))}})},r=function(){return 0===t(".dx-menu-builder").find(".parentError").length||(notify_err(Lang.get("constructor.menu.err_parent")),t("html, body").animate({scrollTop:t(".dx-menu-builder").find(".parentError:last").offset().top-66},2e3),!1)},a=function(){var t=o.itm_to_edit;show_page_splash(),open_form("form",t.attr("data-id"),o.options.menu_list_id,0,0,"",0,"",{after_close:function(n){var i=n.find("[name=parent_id]").val(),e=n.find("[name=order_index]").val();if(i!==t.attr("data-parent-id")||e!==t.attr("data-order-index"))return show_page_splash(),void window.location.reload();var r=n.find("[name=title]").val(),a=n.find("[name=fa_icon]").val();t.attr("data-title")!==r&&(t.attr("data-title",r),t.find(".dx-title:first").text(r)),t.attr("data-icon")!==a&&(t.find(".dx-icon:first").removeClass().addClass(a).addClass("dx-icon"),t.attr("data-icon",a));var s=n.find("[name=color]").val();t.attr("data-color")!==s&&(t.find(".dx-icon:first").css("color",s),t.find(".dx-title:first").css("color",s),t.attr("data-color",s)),o.itm_to_edit=null}})},s=function(){open_form("form",0,o.options.menu_list_id,0,0,"",1,"",{after_close:function(t){var n=parseInt(t.find("[name=item_id]").val());n>0&&(show_page_splash(),window.location.reload())}})},d=function(){show_page_splash(),t(".dx-stick-footer").removeClass("dx-page-in-edit-mode"),window.location.reload()};this.root.find(".dx-undo-btn").click(function(){PageMain.showConfirm(d,null,Lang.get("constructor.menu.confirm_title"),Lang.get("constructor.menu.confirm_msg"),Lang.get("constructor.menu.confirm_yes"),Lang.get("constructor.menu.confirm_no"),null)}),this.root.find(".dx-new-btn").click(function(){return o.nodes?!!r()&&void e(s):void s()}),this.root.find(".dx-edit-menu-link").click(function(){return o.itm_to_edit=t(this).closest(".dd-item"),o.nodes?r()?void e(a):(o.itm_to_edit=null,!1):void a()}),this.root.find(".dx-save-btn").click(function(){return o.nodes?!!r()&&void e():(notify_err(Lang.get("constructor.menu.err_no_changes")),!1)});var l=function(n){var i=n.length?n:t(n.target);window.JSON?(o.nodes=window.JSON.stringify(i.nestable("serialize")),t(".dx-stick-footer").addClass("dx-page-in-edit-mode"),o.root.find(".dx-undo-btn").show()):notify_err(Lang.get("constructor.menu.err_json_support")),t(".dd-item").removeClass("parentError"),t(".dd-item").filter(function(){return 0!==t(this).find(".dd-list").length&&("0"!=t(this).attr("data-list-id")||t(this).attr("data-url")&&"javascript:;"!=t(this).attr("data-url"))}).addClass("parentError")};this.root.find(".dd").nestable({group:1,maxDepth:5}).on("change",l).nestable("collapseAll");var u=function(){var t=o.root.find(".dx-sites-cbo");if(t.val()==o.site_id)return!1;if(o.nodes){if(!r())return t.val(o.site_id),!1;e(u)}var n=o.options.root_url+o.options.builder_url+o.root.find(".dx-sites-cbo").val();show_page_splash(1),window.location.assign(encodeURI(n))};if(t(window).on("beforeunload",function(){if(t(".dx-stick-footer").hasClass("dx-page-in-edit-mode"))return hide_page_splash(1),"Your changes have not been saved."}),this.root.find(".dx-sites-cbo").change(u),!t("body").hasClass("dx-horizontal-menu-ui")){var c=function(){t(".page-sidebar-menu").css("padding-bottom","80px")};PageMain.addResizeCallback(c),c(),t(".dx-menu-builder-stick-title").css("font-size","14px");var f=t(".dx-menu-sites").find("div.col-sm-10");f.css("margin-right","-35px"),f.css("padding-left","30px")}}}(jQuery);